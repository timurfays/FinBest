[2025-05-07T02:31:57.040+0000] {taskinstance.py:1103} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: graph_analysis.build_graph manual__2025-05-07T02:31:49.731579+00:00 [queued]>
[2025-05-07T02:31:57.045+0000] {taskinstance.py:1103} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: graph_analysis.build_graph manual__2025-05-07T02:31:49.731579+00:00 [queued]>
[2025-05-07T02:31:57.045+0000] {taskinstance.py:1308} INFO - Starting attempt 1 of 2
[2025-05-07T02:31:57.055+0000] {taskinstance.py:1327} INFO - Executing <Task(SparkSubmitOperator): build_graph> on 2025-05-07 02:31:49.731579+00:00
[2025-05-07T02:31:57.058+0000] {standard_task_runner.py:57} INFO - Started process 5081 to run task
[2025-05-07T02:31:57.060+0000] {standard_task_runner.py:84} INFO - Running: ['airflow', 'tasks', 'run', 'graph_analysis', 'build_graph', 'manual__2025-05-07T02:31:49.731579+00:00', '--job-id', '243', '--raw', '--subdir', 'DAGS_FOLDER/graph_analysis.py', '--cfg-path', '/tmp/tmp89tqt17o']
[2025-05-07T02:31:57.061+0000] {standard_task_runner.py:85} INFO - Job 243: Subtask build_graph
[2025-05-07T02:31:57.073+0000] {logging_mixin.py:150} WARNING - /home/airflow/.local/lib/python3.8/site-packages/airflow/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-05-07T02:31:57.099+0000] {task_command.py:410} INFO - Running <TaskInstance: graph_analysis.build_graph manual__2025-05-07T02:31:49.731579+00:00 [running]> on host 5c5d1775d94e
[2025-05-07T02:31:57.164+0000] {taskinstance.py:1545} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='finbest' AIRFLOW_CTX_DAG_ID='graph_analysis' AIRFLOW_CTX_TASK_ID='build_graph' AIRFLOW_CTX_EXECUTION_DATE='2025-05-07T02:31:49.731579+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-05-07T02:31:49.731579+00:00'
[2025-05-07T02:31:57.173+0000] {base.py:73} INFO - Using connection ID 'spark_default' for task execution.
[2025-05-07T02:31:57.174+0000] {spark_submit.py:401} INFO - Spark-Submit cmd: spark-submit --master spark://spark-master:7077 --conf spark.driver.maxResultSize=512m --conf spark.sql.shuffle.partitions=10 --packages org.postgresql:postgresql:42.6.0,graphframes:graphframes:0.8.2-spark3.2-s_2.12 --executor-cores 1 --executor-memory 1g --driver-memory 1g --name arrow-spark --verbose /opt/airflow/spark/build_graph.py --jdbc jdbc:postgresql://postgres:5432/finbest --user finbest --password ******
[2025-05-07T02:31:57.188+0000] {spark_submit.py:571} INFO - /opt/spark/bin/load-spark-env.sh: line 68: ps: command not found
[2025-05-07T02:31:57.999+0000] {spark_submit.py:571} INFO - Using properties file: null
[2025-05-07T02:31:58.059+0000] {spark_submit.py:571} INFO - WARNING: An illegal reflective access operation has occurred
[2025-05-07T02:31:58.059+0000] {spark_submit.py:571} INFO - WARNING: Illegal reflective access by org.apache.spark.unsafe.Platform (file:/opt/spark/jars/spark-unsafe_2.12-3.2.4.jar) to constructor java.nio.DirectByteBuffer(long,int)
[2025-05-07T02:31:58.059+0000] {spark_submit.py:571} INFO - WARNING: Please consider reporting this to the maintainers of org.apache.spark.unsafe.Platform
[2025-05-07T02:31:58.059+0000] {spark_submit.py:571} INFO - WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
[2025-05-07T02:31:58.059+0000] {spark_submit.py:571} INFO - WARNING: All illegal access operations will be denied in a future release
[2025-05-07T02:31:58.091+0000] {spark_submit.py:571} INFO - Parsed arguments:
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - master                  spark://spark-master:7077
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - deployMode              null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - executorMemory          1g
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - executorCores           1
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - totalExecutorCores      null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - propertiesFile          null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - driverMemory            1g
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - driverCores             null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - driverExtraClassPath    null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - driverExtraLibraryPath  null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - driverExtraJavaOptions  null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - supervise               false
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - queue                   null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - numExecutors            null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - files                   null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - pyFiles                 null
[2025-05-07T02:31:58.092+0000] {spark_submit.py:571} INFO - archives                null
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - mainClass               null
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - primaryResource         file:/opt/airflow/spark/build_graph.py
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - name                    arrow-spark
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - childArgs               [--jdbc jdbc:postgresql://postgres:5432/finbest --user finbest --password ***]
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - jars                    null
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - packages                org.postgresql:postgresql:42.6.0,graphframes:graphframes:0.8.2-spark3.2-s_2.12
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - packagesExclusions      null
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - repositories            null
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - verbose                 true
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - 
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - Spark properties used, including those specified through
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - --conf and those from the properties file null:
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - (spark.driver.memory,1g)
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - (spark.driver.maxResultSize,512m)
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - (spark.sql.shuffle.partitions,10)
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - 
[2025-05-07T02:31:58.093+0000] {spark_submit.py:571} INFO - 
[2025-05-07T02:31:58.178+0000] {spark_submit.py:571} INFO - :: loading settings :: url = jar:file:/opt/spark/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml
[2025-05-07T02:31:58.259+0000] {spark_submit.py:571} INFO - Ivy Default Cache set to: /home/airflow/.ivy2/cache
[2025-05-07T02:31:58.260+0000] {spark_submit.py:571} INFO - The jars for the packages stored in: /home/airflow/.ivy2/jars
[2025-05-07T02:31:58.265+0000] {spark_submit.py:571} INFO - org.postgresql#postgresql added as a dependency
[2025-05-07T02:31:58.267+0000] {spark_submit.py:571} INFO - graphframes#graphframes added as a dependency
[2025-05-07T02:31:58.268+0000] {spark_submit.py:571} INFO - :: resolving dependencies :: org.apache.spark#spark-submit-parent-d2d0cc81-1f0b-47ca-9614-297a62bfc00e;1.0
[2025-05-07T02:31:58.268+0000] {spark_submit.py:571} INFO - confs: [default]
[2025-05-07T02:31:58.350+0000] {spark_submit.py:571} INFO - found org.postgresql#postgresql;42.6.0 in central
[2025-05-07T02:31:58.368+0000] {spark_submit.py:571} INFO - found org.checkerframework#checker-qual;3.31.0 in central
[2025-05-07T02:31:58.384+0000] {spark_submit.py:571} INFO - found graphframes#graphframes;0.8.2-spark3.2-s_2.12 in spark-packages
[2025-05-07T02:31:58.403+0000] {spark_submit.py:571} INFO - found org.slf4j#slf4j-api;1.7.16 in central
[2025-05-07T02:31:58.420+0000] {spark_submit.py:571} INFO - :: resolution report :: resolve 148ms :: artifacts dl 7ms
[2025-05-07T02:31:58.420+0000] {spark_submit.py:571} INFO - :: modules in use:
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - graphframes#graphframes;0.8.2-spark3.2-s_2.12 from spark-packages in [default]
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - org.checkerframework#checker-qual;3.31.0 from central in [default]
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - org.postgresql#postgresql;42.6.0 from central in [default]
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - org.slf4j#slf4j-api;1.7.16 from central in [default]
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - ---------------------------------------------------------------------
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - |                  |            modules            ||   artifacts   |
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - |       conf       | number| search|dwnlded|evicted|| number|dwnlded|
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - ---------------------------------------------------------------------
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - |      default     |   4   |   0   |   0   |   0   ||   4   |   0   |
[2025-05-07T02:31:58.421+0000] {spark_submit.py:571} INFO - ---------------------------------------------------------------------
[2025-05-07T02:31:58.424+0000] {spark_submit.py:571} INFO - :: retrieving :: org.apache.spark#spark-submit-parent-d2d0cc81-1f0b-47ca-9614-297a62bfc00e
[2025-05-07T02:31:58.424+0000] {spark_submit.py:571} INFO - confs: [default]
[2025-05-07T02:31:58.428+0000] {spark_submit.py:571} INFO - 0 artifacts copied, 4 already retrieved (0kB/4ms)
[2025-05-07T02:31:58.603+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:58 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
[2025-05-07T02:31:58.770+0000] {spark_submit.py:571} INFO - Main class:
[2025-05-07T02:31:58.770+0000] {spark_submit.py:571} INFO - org.apache.spark.deploy.PythonRunner
[2025-05-07T02:31:58.770+0000] {spark_submit.py:571} INFO - Arguments:
[2025-05-07T02:31:58.770+0000] {spark_submit.py:571} INFO - file:/opt/airflow/spark/build_graph.py
[2025-05-07T02:31:58.770+0000] {spark_submit.py:571} INFO - file:///home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar,file:///home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar,file:///home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar,file:///home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar
[2025-05-07T02:31:58.770+0000] {spark_submit.py:571} INFO - --jdbc
[2025-05-07T02:31:58.770+0000] {spark_submit.py:571} INFO - jdbc:postgresql://postgres:5432/finbest
[2025-05-07T02:31:58.771+0000] {spark_submit.py:571} INFO - --user
[2025-05-07T02:31:58.771+0000] {spark_submit.py:571} INFO - finbest
[2025-05-07T02:31:58.771+0000] {spark_submit.py:571} INFO - --password
[2025-05-07T02:31:58.771+0000] {spark_submit.py:571} INFO - ***
[2025-05-07T02:31:58.773+0000] {spark_submit.py:571} INFO - Spark config:
[2025-05-07T02:31:58.773+0000] {spark_submit.py:571} INFO - (spark.driver.maxResultSize,512m)
[2025-05-07T02:31:58.773+0000] {spark_submit.py:571} INFO - (spark.jars,file:///home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar,file:///home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar,file:///home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar,file:///home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar)
[2025-05-07T02:31:58.773+0000] {spark_submit.py:571} INFO - (spark.app.name,arrow-spark)
[2025-05-07T02:31:58.773+0000] {spark_submit.py:571} INFO - (spark.driver.memory,1g)
[2025-05-07T02:31:58.773+0000] {spark_submit.py:571} INFO - (spark.submit.pyFiles,/home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar,/home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar,/home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar,/home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar)
[2025-05-07T02:31:58.773+0000] {spark_submit.py:571} INFO - (spark.files,file:///home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar,file:///home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar,file:///home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar,file:///home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar)
[2025-05-07T02:31:58.773+0000] {spark_submit.py:571} INFO - (spark.submit.deployMode,client)
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - (spark.master,spark://spark-master:7077)
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - (spark.executor.memory,1g)
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - (spark.executor.cores,1)
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - (spark.repl.local.jars,file:///home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar,file:///home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar,file:///home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar,file:///home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar)
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - (spark.sql.shuffle.partitions,10)
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - Classpath elements:
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - file:///home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - file:///home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - file:///home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - file:///home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - 
[2025-05-07T02:31:58.774+0000] {spark_submit.py:571} INFO - 
[2025-05-07T02:31:59.821+0000] {spark_submit.py:571} INFO - Using Spark's default log4j profile: org/apache/spark/log4j-defaults.properties
[2025-05-07T02:31:59.826+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO SparkContext: Running Spark version 3.2.4
[2025-05-07T02:31:59.841+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO ResourceUtils: ==============================================================
[2025-05-07T02:31:59.841+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO ResourceUtils: No custom resources configured for spark.driver.
[2025-05-07T02:31:59.841+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO ResourceUtils: ==============================================================
[2025-05-07T02:31:59.841+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO SparkContext: Submitted application: FinBestGraphAnalysis
[2025-05-07T02:31:59.860+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO ResourceProfile: Default ResourceProfile created, executor resources: Map(cores -> name: cores, amount: 1, script: , vendor: , memory -> name: memory, amount: 1024, script: , vendor: , offHeap -> name: offHeap, amount: 0, script: , vendor: ), task resources: Map(cpus -> name: cpus, amount: 1.0)
[2025-05-07T02:31:59.871+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO ResourceProfile: Limiting resource is cpus at 1 tasks per executor
[2025-05-07T02:31:59.872+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO ResourceProfileManager: Added ResourceProfile id: 0
[2025-05-07T02:31:59.909+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO SecurityManager: Changing view acls to: airflow
[2025-05-07T02:31:59.909+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO SecurityManager: Changing modify acls to: airflow
[2025-05-07T02:31:59.910+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO SecurityManager: Changing view acls groups to:
[2025-05-07T02:31:59.910+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO SecurityManager: Changing modify acls groups to:
[2025-05-07T02:31:59.910+0000] {spark_submit.py:571} INFO - 25/05/07 02:31:59 INFO SecurityManager: SecurityManager: authentication disabled; ui acls disabled; users  with view permissions: Set(airflow); groups with view permissions: Set(); users  with modify permissions: Set(airflow); groups with modify permissions: Set()
[2025-05-07T02:32:00.103+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO Utils: Successfully started service 'sparkDriver' on port 45761.
[2025-05-07T02:32:00.120+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkEnv: Registering MapOutputTracker
[2025-05-07T02:32:00.143+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkEnv: Registering BlockManagerMaster
[2025-05-07T02:32:00.156+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO BlockManagerMasterEndpoint: Using org.apache.spark.storage.DefaultTopologyMapper for getting topology information
[2025-05-07T02:32:00.156+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO BlockManagerMasterEndpoint: BlockManagerMasterEndpoint up
[2025-05-07T02:32:00.159+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkEnv: Registering BlockManagerMasterHeartbeat
[2025-05-07T02:32:00.177+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO DiskBlockManager: Created local directory at /tmp/blockmgr-e7e8969c-39d7-401e-93ed-95c53321fbb7
[2025-05-07T02:32:00.195+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO MemoryStore: MemoryStore started with capacity 434.4 MiB
[2025-05-07T02:32:00.208+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkEnv: Registering OutputCommitCoordinator
[2025-05-07T02:32:00.393+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO Utils: Successfully started service 'SparkUI' on port 4040.
[2025-05-07T02:32:00.443+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkUI: Bound SparkUI to 0.0.0.0, and started at http://5c5d1775d94e:4040
[2025-05-07T02:32:00.453+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkContext: Added JAR file:///home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar at spark://5c5d1775d94e:45761/jars/org.postgresql_postgresql-42.6.0.jar with timestamp 1746585119819
[2025-05-07T02:32:00.453+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkContext: Added JAR file:///home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar at spark://5c5d1775d94e:45761/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar with timestamp 1746585119819
[2025-05-07T02:32:00.453+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkContext: Added JAR file:///home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar at spark://5c5d1775d94e:45761/jars/org.checkerframework_checker-qual-3.31.0.jar with timestamp 1746585119819
[2025-05-07T02:32:00.453+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkContext: Added JAR file:///home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar at spark://5c5d1775d94e:45761/jars/org.slf4j_slf4j-api-1.7.16.jar with timestamp 1746585119819
[2025-05-07T02:32:00.455+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkContext: Added file file:///home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar at spark://5c5d1775d94e:45761/files/org.postgresql_postgresql-42.6.0.jar with timestamp 1746585119819
[2025-05-07T02:32:00.455+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO Utils: Copying /home/airflow/.ivy2/jars/org.postgresql_postgresql-42.6.0.jar to /tmp/spark-6c0bf680-691b-4024-b887-d36c340192ec/userFiles-68fcfffb-5474-4731-8a82-2bd96daac20c/org.postgresql_postgresql-42.6.0.jar
[2025-05-07T02:32:00.464+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkContext: Added file file:///home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar at spark://5c5d1775d94e:45761/files/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar with timestamp 1746585119819
[2025-05-07T02:32:00.465+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO Utils: Copying /home/airflow/.ivy2/jars/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar to /tmp/spark-6c0bf680-691b-4024-b887-d36c340192ec/userFiles-68fcfffb-5474-4731-8a82-2bd96daac20c/graphframes_graphframes-0.8.2-spark3.2-s_2.12.jar
[2025-05-07T02:32:00.469+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkContext: Added file file:///home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar at spark://5c5d1775d94e:45761/files/org.checkerframework_checker-qual-3.31.0.jar with timestamp 1746585119819
[2025-05-07T02:32:00.469+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO Utils: Copying /home/airflow/.ivy2/jars/org.checkerframework_checker-qual-3.31.0.jar to /tmp/spark-6c0bf680-691b-4024-b887-d36c340192ec/userFiles-68fcfffb-5474-4731-8a82-2bd96daac20c/org.checkerframework_checker-qual-3.31.0.jar
[2025-05-07T02:32:00.473+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO SparkContext: Added file file:///home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar at spark://5c5d1775d94e:45761/files/org.slf4j_slf4j-api-1.7.16.jar with timestamp 1746585119819
[2025-05-07T02:32:00.473+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO Utils: Copying /home/airflow/.ivy2/jars/org.slf4j_slf4j-api-1.7.16.jar to /tmp/spark-6c0bf680-691b-4024-b887-d36c340192ec/userFiles-68fcfffb-5474-4731-8a82-2bd96daac20c/org.slf4j_slf4j-api-1.7.16.jar
[2025-05-07T02:32:00.595+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO StandaloneAppClient$ClientEndpoint: Connecting to master spark://spark-master:7077...
[2025-05-07T02:32:00.628+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO TransportClientFactory: Successfully created connection to spark-master/172.20.0.3:7077 after 21 ms (0 ms spent in bootstraps)
[2025-05-07T02:32:00.726+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO StandaloneSchedulerBackend: Connected to Spark cluster with app ID app-20250507023200-0002
[2025-05-07T02:32:00.728+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO StandaloneAppClient$ClientEndpoint: Executor added: app-20250507023200-0002/0 on worker-20250506210741-172.20.0.5-46203 (172.20.0.5:46203) with 1 core(s)
[2025-05-07T02:32:00.730+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO StandaloneSchedulerBackend: Granted executor ID app-20250507023200-0002/0 on hostPort 172.20.0.5:46203 with 1 core(s), 1024.0 MiB RAM
[2025-05-07T02:32:00.733+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO Utils: Successfully started service 'org.apache.spark.network.netty.NettyBlockTransferService' on port 46251.
[2025-05-07T02:32:00.733+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO NettyBlockTransferService: Server created on 5c5d1775d94e:46251
[2025-05-07T02:32:00.734+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO BlockManager: Using org.apache.spark.storage.RandomBlockReplicationPolicy for block replication policy
[2025-05-07T02:32:00.739+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO BlockManagerMaster: Registering BlockManager BlockManagerId(driver, 5c5d1775d94e, 46251, None)
[2025-05-07T02:32:00.744+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO BlockManagerMasterEndpoint: Registering block manager 5c5d1775d94e:46251 with 434.4 MiB RAM, BlockManagerId(driver, 5c5d1775d94e, 46251, None)
[2025-05-07T02:32:00.747+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO BlockManagerMaster: Registered BlockManager BlockManagerId(driver, 5c5d1775d94e, 46251, None)
[2025-05-07T02:32:00.749+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO BlockManager: Initialized BlockManager: BlockManagerId(driver, 5c5d1775d94e, 46251, None)
[2025-05-07T02:32:00.759+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO StandaloneAppClient$ClientEndpoint: Executor updated: app-20250507023200-0002/0 is now RUNNING
[2025-05-07T02:32:00.929+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:00 INFO StandaloneSchedulerBackend: SchedulerBackend is ready for scheduling beginning after reached minRegisteredResourcesRatio: 0.0
[2025-05-07T02:32:01.073+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:01 INFO SharedState: Setting hive.metastore.warehouse.dir ('null') to the value of spark.sql.warehouse.dir.
[2025-05-07T02:32:01.074+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:01 INFO SharedState: Warehouse path is 'file:/opt/airflow/spark-warehouse'.
[2025-05-07T02:32:01.750+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:01,750 [INFO] SparkSession создана
[2025-05-07T02:32:01.750+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:01,750 [INFO] Загружаем клиентов и транзакции
[2025-05-07T02:32:03.639+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:03 INFO CoarseGrainedSchedulerBackend$DriverEndpoint: Registered executor NettyRpcEndpointRef(spark-client://Executor) (172.20.0.5:38764) with ID 0,  ResourceProfileId 0
[2025-05-07T02:32:03.777+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:03 INFO BlockManagerMasterEndpoint: Registering block manager 172.20.0.5:46809 with 434.4 MiB RAM, BlockManagerId(0, 172.20.0.5, 46809, None)
[2025-05-07T02:32:05.479+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO CodeGenerator: Code generated in 103.092764 ms
[2025-05-07T02:32:05.530+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO DAGScheduler: Registering RDD 2 (count at NativeMethodAccessorImpl.java:0) as input to shuffle 0
[2025-05-07T02:32:05.533+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO DAGScheduler: Got map stage job 0 (count at NativeMethodAccessorImpl.java:0) with 1 output partitions
[2025-05-07T02:32:05.534+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO DAGScheduler: Final stage: ShuffleMapStage 0 (count at NativeMethodAccessorImpl.java:0)
[2025-05-07T02:32:05.534+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO DAGScheduler: Parents of final stage: List()
[2025-05-07T02:32:05.535+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO DAGScheduler: Missing parents: List()
[2025-05-07T02:32:05.539+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO DAGScheduler: Submitting ShuffleMapStage 0 (MapPartitionsRDD[2] at count at NativeMethodAccessorImpl.java:0), which has no missing parents
[2025-05-07T02:32:05.638+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO MemoryStore: Block broadcast_0 stored as values in memory (estimated size 12.9 KiB, free 434.4 MiB)
[2025-05-07T02:32:05.705+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO MemoryStore: Block broadcast_0_piece0 stored as bytes in memory (estimated size 6.8 KiB, free 434.4 MiB)
[2025-05-07T02:32:05.731+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO BlockManagerInfo: Added broadcast_0_piece0 in memory on 5c5d1775d94e:46251 (size: 6.8 KiB, free: 434.4 MiB)
[2025-05-07T02:32:05.734+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO SparkContext: Created broadcast 0 from broadcast at DAGScheduler.scala:1474
[2025-05-07T02:32:05.822+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO DAGScheduler: Submitting 1 missing tasks from ShuffleMapStage 0 (MapPartitionsRDD[2] at count at NativeMethodAccessorImpl.java:0) (first 15 tasks are for partitions Vector(0))
[2025-05-07T02:32:05.838+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO TaskSchedulerImpl: Adding task set 0.0 with 1 tasks resource profile 0
[2025-05-07T02:32:05.958+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:05 INFO TaskSetManager: Starting task 0.0 in stage 0.0 (TID 0) (172.20.0.5, executor 0, partition 0, PROCESS_LOCAL, 4292 bytes) taskResourceAssignments Map()
[2025-05-07T02:32:06.325+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:06 INFO BlockManagerInfo: Added broadcast_0_piece0 in memory on 172.20.0.5:46809 (size: 6.8 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.256+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSetManager: Finished task 0.0 in stage 0.0 (TID 0) in 1319 ms on 172.20.0.5 (executor 0) (1/1)
[2025-05-07T02:32:07.257+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Removed TaskSet 0.0, whose tasks have all completed, from pool
[2025-05-07T02:32:07.263+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: ShuffleMapStage 0 (count at NativeMethodAccessorImpl.java:0) finished in 1.713 s
[2025-05-07T02:32:07.263+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: looking for newly runnable stages
[2025-05-07T02:32:07.263+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: running: Set()
[2025-05-07T02:32:07.263+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: waiting: Set()
[2025-05-07T02:32:07.263+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: failed: Set()
[2025-05-07T02:32:07.301+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO CodeGenerator: Code generated in 8.961391 ms
[2025-05-07T02:32:07.335+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO SparkContext: Starting job: count at NativeMethodAccessorImpl.java:0
[2025-05-07T02:32:07.339+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Got job 1 (count at NativeMethodAccessorImpl.java:0) with 1 output partitions
[2025-05-07T02:32:07.340+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Final stage: ResultStage 2 (count at NativeMethodAccessorImpl.java:0)
[2025-05-07T02:32:07.340+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Parents of final stage: List(ShuffleMapStage 1)
[2025-05-07T02:32:07.340+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Missing parents: List()
[2025-05-07T02:32:07.341+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Submitting ResultStage 2 (MapPartitionsRDD[5] at count at NativeMethodAccessorImpl.java:0), which has no missing parents
[2025-05-07T02:32:07.348+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO MemoryStore: Block broadcast_1 stored as values in memory (estimated size 11.0 KiB, free 434.4 MiB)
[2025-05-07T02:32:07.350+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO MemoryStore: Block broadcast_1_piece0 stored as bytes in memory (estimated size 5.5 KiB, free 434.4 MiB)
[2025-05-07T02:32:07.351+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Added broadcast_1_piece0 in memory on 5c5d1775d94e:46251 (size: 5.5 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.351+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO SparkContext: Created broadcast 1 from broadcast at DAGScheduler.scala:1474
[2025-05-07T02:32:07.352+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Submitting 1 missing tasks from ResultStage 2 (MapPartitionsRDD[5] at count at NativeMethodAccessorImpl.java:0) (first 15 tasks are for partitions Vector(0))
[2025-05-07T02:32:07.352+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Adding task set 2.0 with 1 tasks resource profile 0
[2025-05-07T02:32:07.358+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSetManager: Starting task 0.0 in stage 2.0 (TID 1) (172.20.0.5, executor 0, partition 0, NODE_LOCAL, 4457 bytes) taskResourceAssignments Map()
[2025-05-07T02:32:07.380+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Added broadcast_1_piece0 in memory on 172.20.0.5:46809 (size: 5.5 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.457+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO MapOutputTrackerMasterEndpoint: Asked to send map output locations for shuffle 0 to 172.20.0.5:38764
[2025-05-07T02:32:07.580+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSetManager: Finished task 0.0 in stage 2.0 (TID 1) in 224 ms on 172.20.0.5 (executor 0) (1/1)
[2025-05-07T02:32:07.581+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Removed TaskSet 2.0, whose tasks have all completed, from pool
[2025-05-07T02:32:07.582+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: ResultStage 2 (count at NativeMethodAccessorImpl.java:0) finished in 0.235 s
[2025-05-07T02:32:07.583+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Job 1 is finished. Cancelling potential speculative or zombie tasks for this job
[2025-05-07T02:32:07.583+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Killing all running tasks in stage 2: Stage finished
[2025-05-07T02:32:07.584+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Job 1 finished: count at NativeMethodAccessorImpl.java:0, took 0.248715 s
[2025-05-07T02:32:07.636+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Registering RDD 8 (count at NativeMethodAccessorImpl.java:0) as input to shuffle 1
[2025-05-07T02:32:07.637+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Got map stage job 2 (count at NativeMethodAccessorImpl.java:0) with 1 output partitions
[2025-05-07T02:32:07.637+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Final stage: ShuffleMapStage 3 (count at NativeMethodAccessorImpl.java:0)
[2025-05-07T02:32:07.637+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Parents of final stage: List()
[2025-05-07T02:32:07.637+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Missing parents: List()
[2025-05-07T02:32:07.639+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Submitting ShuffleMapStage 3 (MapPartitionsRDD[8] at count at NativeMethodAccessorImpl.java:0), which has no missing parents
[2025-05-07T02:32:07.642+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO MemoryStore: Block broadcast_2 stored as values in memory (estimated size 12.9 KiB, free 434.4 MiB)
[2025-05-07T02:32:07.645+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO MemoryStore: Block broadcast_2_piece0 stored as bytes in memory (estimated size 6.8 KiB, free 434.3 MiB)
[2025-05-07T02:32:07.646+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Added broadcast_2_piece0 in memory on 5c5d1775d94e:46251 (size: 6.8 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.647+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO SparkContext: Created broadcast 2 from broadcast at DAGScheduler.scala:1474
[2025-05-07T02:32:07.647+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Submitting 1 missing tasks from ShuffleMapStage 3 (MapPartitionsRDD[8] at count at NativeMethodAccessorImpl.java:0) (first 15 tasks are for partitions Vector(0))
[2025-05-07T02:32:07.648+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Adding task set 3.0 with 1 tasks resource profile 0
[2025-05-07T02:32:07.649+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSetManager: Starting task 0.0 in stage 3.0 (TID 2) (172.20.0.5, executor 0, partition 0, PROCESS_LOCAL, 4292 bytes) taskResourceAssignments Map()
[2025-05-07T02:32:07.665+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Added broadcast_2_piece0 in memory on 172.20.0.5:46809 (size: 6.8 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.697+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSetManager: Finished task 0.0 in stage 3.0 (TID 2) in 49 ms on 172.20.0.5 (executor 0) (1/1)
[2025-05-07T02:32:07.698+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Removed TaskSet 3.0, whose tasks have all completed, from pool
[2025-05-07T02:32:07.698+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: ShuffleMapStage 3 (count at NativeMethodAccessorImpl.java:0) finished in 0.059 s
[2025-05-07T02:32:07.699+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: looking for newly runnable stages
[2025-05-07T02:32:07.699+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: running: Set()
[2025-05-07T02:32:07.699+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: waiting: Set()
[2025-05-07T02:32:07.700+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: failed: Set()
[2025-05-07T02:32:07.724+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO SparkContext: Starting job: count at NativeMethodAccessorImpl.java:0
[2025-05-07T02:32:07.725+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Got job 3 (count at NativeMethodAccessorImpl.java:0) with 1 output partitions
[2025-05-07T02:32:07.726+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Final stage: ResultStage 5 (count at NativeMethodAccessorImpl.java:0)
[2025-05-07T02:32:07.726+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Parents of final stage: List(ShuffleMapStage 4)
[2025-05-07T02:32:07.726+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Missing parents: List()
[2025-05-07T02:32:07.726+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Submitting ResultStage 5 (MapPartitionsRDD[11] at count at NativeMethodAccessorImpl.java:0), which has no missing parents
[2025-05-07T02:32:07.729+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO MemoryStore: Block broadcast_3 stored as values in memory (estimated size 11.0 KiB, free 434.3 MiB)
[2025-05-07T02:32:07.730+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO MemoryStore: Block broadcast_3_piece0 stored as bytes in memory (estimated size 5.5 KiB, free 434.3 MiB)
[2025-05-07T02:32:07.731+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Added broadcast_3_piece0 in memory on 5c5d1775d94e:46251 (size: 5.5 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.732+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO SparkContext: Created broadcast 3 from broadcast at DAGScheduler.scala:1474
[2025-05-07T02:32:07.733+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Submitting 1 missing tasks from ResultStage 5 (MapPartitionsRDD[11] at count at NativeMethodAccessorImpl.java:0) (first 15 tasks are for partitions Vector(0))
[2025-05-07T02:32:07.733+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Adding task set 5.0 with 1 tasks resource profile 0
[2025-05-07T02:32:07.735+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSetManager: Starting task 0.0 in stage 5.0 (TID 3) (172.20.0.5, executor 0, partition 0, NODE_LOCAL, 4457 bytes) taskResourceAssignments Map()
[2025-05-07T02:32:07.756+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Added broadcast_3_piece0 in memory on 172.20.0.5:46809 (size: 5.5 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.766+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO MapOutputTrackerMasterEndpoint: Asked to send map output locations for shuffle 1 to 172.20.0.5:38764
[2025-05-07T02:32:07.778+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSetManager: Finished task 0.0 in stage 5.0 (TID 3) in 44 ms on 172.20.0.5 (executor 0) (1/1)
[2025-05-07T02:32:07.779+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Removed TaskSet 5.0, whose tasks have all completed, from pool
[2025-05-07T02:32:07.779+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: ResultStage 5 (count at NativeMethodAccessorImpl.java:0) finished in 0.052 s
[2025-05-07T02:32:07.779+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Job 3 is finished. Cancelling potential speculative or zombie tasks for this job
[2025-05-07T02:32:07.780+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO TaskSchedulerImpl: Killing all running tasks in stage 5: Stage finished
[2025-05-07T02:32:07.780+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO DAGScheduler: Job 3 finished: count at NativeMethodAccessorImpl.java:0, took 0.055115 s
[2025-05-07T02:32:07.781+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:07,781 [INFO] Загружено 4652 транзакций и 1200 клиентов
[2025-05-07T02:32:07.885+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Removed broadcast_1_piece0 on 5c5d1775d94e:46251 in memory (size: 5.5 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.896+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Removed broadcast_1_piece0 on 172.20.0.5:46809 in memory (size: 5.5 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.917+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Removed broadcast_2_piece0 on 5c5d1775d94e:46251 in memory (size: 6.8 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.925+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Removed broadcast_2_piece0 on 172.20.0.5:46809 in memory (size: 6.8 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.934+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Removed broadcast_3_piece0 on 5c5d1775d94e:46251 in memory (size: 5.5 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.939+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Removed broadcast_3_piece0 on 172.20.0.5:46809 in memory (size: 5.5 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.948+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Removed broadcast_0_piece0 on 5c5d1775d94e:46251 in memory (size: 6.8 KiB, free: 434.4 MiB)
[2025-05-07T02:32:07.950+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:07 INFO BlockManagerInfo: Removed broadcast_0_piece0 on 172.20.0.5:46809 in memory (size: 6.8 KiB, free: 434.4 MiB)
[2025-05-07T02:32:08.267+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:08,267 [INFO] Создаем вершины двудольного графа
[2025-05-07T02:32:08.702+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:08,702 [INFO] Создаем ATM-хабы
[2025-05-07T02:32:08.891+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:08,891 [INFO] Объединяем ребра двудольного графа
[2025-05-07T02:32:08.980+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:08,980 [INFO] Создаем P2P-слой
[2025-05-07T02:32:09.001+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:09,001 [INFO] Создаем проекцию клиент-клиент
[2025-05-07T02:32:09.692+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:09,633 [ERROR] Ошибка при обработке транзакционного графа: grouping expressions sequence is empty, and 'a' is not an aggregate function. Wrap '(LOG1P(sum((e.`weight` * e2.`weight`))) AS weight)' in windowing function(s) or wrap 'a' in first() (or first_value) if you don't care which value you get.;
[2025-05-07T02:32:09.692+0000] {spark_submit.py:571} INFO - Aggregate [a#488.id AS src#860, c#627.id AS dst#861, shared AS relationship#862, LOG1P(sum((e#486.weight * e2#625.weight))) AS weight#864]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - +- Filter (((a#488.bipartite = 0) AND (c#627.bipartite = 0)) AND ((b#490.bipartite = 1) AND (a#488.id < c#627.id)))
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - +- Project [a#488, e#486, b#490, e2#625, c#627]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - +- Join Inner, (e2#625.dst = c#627.id)
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :- Join Inner, (e2#625.src = b#490.id)
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :- Join Inner, (e#486.dst = b#490.id)
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :- Join Inner, (e#486.src = a#488.id)
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :- Project [struct(src, src#142, dst, dst#143, relationship, relationship#156, weight, weight#160) AS e#486]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :  +- Union false, false
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#142, dst#143, relationship#156, weight#160]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#142, dst#143, relationship#156, 1.0 AS weight#160]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#142, dst#143, share_m AS relationship#156]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#142, dst#143]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#15 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#14, client_id#15, datetime#16, amount#17, currency#18, coalesce(merchant#19, cast(no_merchant as string)) AS merchant#114, transaction_type#20, category#21, country_code#22, region#23, coalesce(device_type#24, cast(unknown as string)) AS device_type#115, session_id#25, channel#26, transaction_purpose#27, ip_network#28, recipient_id_hash#29, dt_30#79]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#14, client_id#15, datetime#16, amount#17, currency#18, merchant#19, transaction_type#20, category#21, country_code#22, region#23, device_type#24, session_id#25, channel#26, transaction_purpose#27, ip_network#28, recipient_id_hash#29, cast(date_trunc(minute, datetime#16, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#14,client_id#15,datetime#16,amount#17,currency#18,merchant#19,transaction_type#20,category#21,country_code#22,region#23,device_type#24,session_id#25,channel#26,transaction_purpose#27,ip_network#28,recipient_id_hash#29] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.693+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#165, dst#166, relationship#179, weight#183]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#165, dst#166, relationship#179, 0.5 AS weight#183]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#165, dst#166, share_sess AS relationship#179]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#165, dst#166]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(session_id#387)
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#377 AS src#165, concat(sess:, session_id#387) AS dst#166, session_id#387]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#376, client_id#377, datetime#378, amount#379, currency#380, coalesce(merchant#381, cast(no_merchant as string)) AS merchant#114, transaction_type#382, category#383, country_code#384, region#385, coalesce(device_type#386, cast(unknown as string)) AS device_type#115, session_id#387, channel#388, transaction_purpose#389, ip_network#390, recipient_id_hash#391, dt_30#79]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#376, client_id#377, datetime#378, amount#379, currency#380, merchant#381, transaction_type#382, category#383, country_code#384, region#385, device_type#386, session_id#387, channel#388, transaction_purpose#389, ip_network#390, recipient_id_hash#391, cast(date_trunc(minute, datetime#378, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#376,client_id#377,datetime#378,amount#379,currency#380,merchant#381,transaction_type#382,category#383,country_code#384,region#385,device_type#386,session_id#387,channel#388,transaction_purpose#389,ip_network#390,recipient_id_hash#391] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#188, dst#189, relationship#202, weight#206]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#188, dst#189, relationship#202, 0.7 AS weight#206]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#188, dst#189, share_ip AS relationship#202]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#188, dst#189]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(ip_network#410)
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#397 AS src#188, concat(ip:, ip_network#410) AS dst#189, ip_network#410]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#396, client_id#397, datetime#398, amount#399, currency#400, coalesce(merchant#401, cast(no_merchant as string)) AS merchant#114, transaction_type#402, category#403, country_code#404, region#405, coalesce(device_type#406, cast(unknown as string)) AS device_type#115, session_id#407, channel#408, transaction_purpose#409, ip_network#410, recipient_id_hash#411, dt_30#79]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#396, client_id#397, datetime#398, amount#399, currency#400, merchant#401, transaction_type#402, category#403, country_code#404, region#405, device_type#406, session_id#407, channel#408, transaction_purpose#409, ip_network#410, recipient_id_hash#411, cast(date_trunc(minute, datetime#398, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#396,client_id#397,datetime#398,amount#399,currency#400,merchant#401,transaction_type#402,category#403,country_code#404,region#405,device_type#406,session_id#407,channel#408,transaction_purpose#409,ip_network#410,recipient_id_hash#411] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.694+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#211, dst#212, relationship#225, weight#229]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#211, dst#212, relationship#225, 0.3 AS weight#229]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#211, dst#212, share_dev AS relationship#225]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#211, dst#212]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#417 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#416, client_id#417, datetime#418, amount#419, currency#420, coalesce(merchant#421, cast(no_merchant as string)) AS merchant#114, transaction_type#422, category#423, country_code#424, region#425, coalesce(device_type#426, cast(unknown as string)) AS device_type#115, session_id#427, channel#428, transaction_purpose#429, ip_network#430, recipient_id_hash#431, dt_30#79]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#416, client_id#417, datetime#418, amount#419, currency#420, merchant#421, transaction_type#422, category#423, country_code#424, region#425, device_type#426, session_id#427, channel#428, transaction_purpose#429, ip_network#430, recipient_id_hash#431, cast(date_trunc(minute, datetime#418, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#416,client_id#417,datetime#418,amount#419,currency#420,merchant#421,transaction_type#422,category#423,country_code#424,region#425,device_type#426,session_id#427,channel#428,transaction_purpose#429,ip_network#430,recipient_id_hash#431] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#234, dst#235, relationship#248, weight#252]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#234, dst#235, relationship#248, 0.2 AS weight#252]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#234, dst#235, share_reg AS relationship#248]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#234, dst#235]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(region#445)
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#437 AS src#234, concat(reg:, region#445) AS dst#235, region#445]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#436, client_id#437, datetime#438, amount#439, currency#440, coalesce(merchant#441, cast(no_merchant as string)) AS merchant#114, transaction_type#442, category#443, country_code#444, region#445, coalesce(device_type#446, cast(unknown as string)) AS device_type#115, session_id#447, channel#448, transaction_purpose#449, ip_network#450, recipient_id_hash#451, dt_30#79]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#436, client_id#437, datetime#438, amount#439, currency#440, merchant#441, transaction_type#442, category#443, country_code#444, region#445, device_type#446, session_id#447, channel#448, transaction_purpose#449, ip_network#450, recipient_id_hash#451, cast(date_trunc(minute, datetime#438, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#436,client_id#437,datetime#438,amount#439,currency#440,merchant#441,transaction_type#442,category#443,country_code#444,region#445,device_type#446,session_id#447,channel#448,transaction_purpose#449,ip_network#450,recipient_id_hash#451] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :     +- Project [src#257, dst#258, cast(relationship#272 as string) AS relationship#472, weight#273]
[2025-05-07T02:32:09.695+0000] {spark_submit.py:571} INFO - :  :  :  :        +- Project [src#257, dst#258, (cast(transaction_type#462 as double) + cast(_atm as double)) AS relationship#272, CASE WHEN (transaction_type#462 = withdrawal) THEN 0.8 ELSE 0.6 END AS weight#273]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :  :           +- Project [client_id#457 AS src#257, concat(atm:, region#465, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#462]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :  :              +- Filter transaction_type#462 IN (withdrawal,deposit)
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :  :                 +- Project [transaction_id#456, client_id#457, datetime#458, amount#459, currency#460, coalesce(merchant#461, cast(no_merchant as string)) AS merchant#114, transaction_type#462, category#463, country_code#464, region#465, coalesce(device_type#466, cast(unknown as string)) AS device_type#115, session_id#467, channel#468, transaction_purpose#469, ip_network#470, recipient_id_hash#471, dt_30#79]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :  :                    +- Project [transaction_id#456, client_id#457, datetime#458, amount#459, currency#460, merchant#461, transaction_type#462, category#463, country_code#464, region#465, device_type#466, session_id#467, channel#468, transaction_purpose#469, ip_network#470, recipient_id_hash#471, cast(date_trunc(minute, datetime#458, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :  :                       +- Relation [transaction_id#456,client_id#457,datetime#458,amount#459,currency#460,merchant#461,transaction_type#462,category#463,country_code#464,region#465,device_type#466,session_id#467,channel#468,transaction_purpose#469,ip_network#470,recipient_id_hash#471] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :  +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS a#488]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :     +- Union false, false
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [client_id#0 AS id#133]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Relation [client_id#0,first_name#1,last_name#2,email#3,passport_id#4,registration_date#5,status#6] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#143]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#143]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#142, dst#143]
[2025-05-07T02:32:09.696+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#495 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#494, client_id#495, datetime#496, amount#497, currency#498, coalesce(merchant#499, cast(no_merchant as string)) AS merchant#114, transaction_type#500, category#501, country_code#502, region#503, coalesce(device_type#504, cast(unknown as string)) AS device_type#115, session_id#505, channel#506, transaction_purpose#507, ip_network#508, recipient_id_hash#509, dt_30#79]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#494, client_id#495, datetime#496, amount#497, currency#498, merchant#499, transaction_type#500, category#501, country_code#502, region#503, device_type#504, session_id#505, channel#506, transaction_purpose#507, ip_network#508, recipient_id_hash#509, cast(date_trunc(minute, datetime#496, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#494,client_id#495,datetime#496,amount#497,currency#498,merchant#499,transaction_type#500,category#501,country_code#502,region#503,device_type#504,session_id#505,channel#506,transaction_purpose#507,ip_network#508,recipient_id_hash#509] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#166]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#166]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#165, dst#166]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(session_id#292)
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#282 AS src#165, concat(sess:, session_id#292) AS dst#166, session_id#292]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#281, client_id#282, datetime#283, amount#284, currency#285, coalesce(merchant#286, cast(no_merchant as string)) AS merchant#114, transaction_type#287, category#288, country_code#289, region#290, coalesce(device_type#291, cast(unknown as string)) AS device_type#115, session_id#292, channel#293, transaction_purpose#294, ip_network#295, recipient_id_hash#296, dt_30#79]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#281, client_id#282, datetime#283, amount#284, currency#285, merchant#286, transaction_type#287, category#288, country_code#289, region#290, device_type#291, session_id#292, channel#293, transaction_purpose#294, ip_network#295, recipient_id_hash#296, cast(date_trunc(minute, datetime#283, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#281,client_id#282,datetime#283,amount#284,currency#285,merchant#286,transaction_type#287,category#288,country_code#289,region#290,device_type#291,session_id#292,channel#293,transaction_purpose#294,ip_network#295,recipient_id_hash#296] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#189]
[2025-05-07T02:32:09.697+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#189]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#188, dst#189]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(ip_network#314)
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#301 AS src#188, concat(ip:, ip_network#314) AS dst#189, ip_network#314]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#300, client_id#301, datetime#302, amount#303, currency#304, coalesce(merchant#305, cast(no_merchant as string)) AS merchant#114, transaction_type#306, category#307, country_code#308, region#309, coalesce(device_type#310, cast(unknown as string)) AS device_type#115, session_id#311, channel#312, transaction_purpose#313, ip_network#314, recipient_id_hash#315, dt_30#79]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#300, client_id#301, datetime#302, amount#303, currency#304, merchant#305, transaction_type#306, category#307, country_code#308, region#309, device_type#310, session_id#311, channel#312, transaction_purpose#313, ip_network#314, recipient_id_hash#315, cast(date_trunc(minute, datetime#302, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#300,client_id#301,datetime#302,amount#303,currency#304,merchant#305,transaction_type#306,category#307,country_code#308,region#309,device_type#310,session_id#311,channel#312,transaction_purpose#313,ip_network#314,recipient_id_hash#315] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#212]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#212]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#211, dst#212]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#320 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.698+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#319, client_id#320, datetime#321, amount#322, currency#323, coalesce(merchant#324, cast(no_merchant as string)) AS merchant#114, transaction_type#325, category#326, country_code#327, region#328, coalesce(device_type#329, cast(unknown as string)) AS device_type#115, session_id#330, channel#331, transaction_purpose#332, ip_network#333, recipient_id_hash#334, dt_30#79]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#319, client_id#320, datetime#321, amount#322, currency#323, merchant#324, transaction_type#325, category#326, country_code#327, region#328, device_type#329, session_id#330, channel#331, transaction_purpose#332, ip_network#333, recipient_id_hash#334, cast(date_trunc(minute, datetime#321, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#319,client_id#320,datetime#321,amount#322,currency#323,merchant#324,transaction_type#325,category#326,country_code#327,region#328,device_type#329,session_id#330,channel#331,transaction_purpose#332,ip_network#333,recipient_id_hash#334] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#235]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#235]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#234, dst#235]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(region#347)
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#339 AS src#234, concat(reg:, region#347) AS dst#235, region#347]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#338, client_id#339, datetime#340, amount#341, currency#342, coalesce(merchant#343, cast(no_merchant as string)) AS merchant#114, transaction_type#344, category#345, country_code#346, region#347, coalesce(device_type#348, cast(unknown as string)) AS device_type#115, session_id#349, channel#350, transaction_purpose#351, ip_network#352, recipient_id_hash#353, dt_30#79]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#338, client_id#339, datetime#340, amount#341, currency#342, merchant#343, transaction_type#344, category#345, country_code#346, region#347, device_type#348, session_id#349, channel#350, transaction_purpose#351, ip_network#352, recipient_id_hash#353, cast(date_trunc(minute, datetime#340, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#338,client_id#339,datetime#340,amount#341,currency#342,merchant#343,transaction_type#344,category#345,country_code#346,region#347,device_type#348,session_id#349,channel#350,transaction_purpose#351,ip_network#352,recipient_id_hash#353] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :        +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :           +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :              +- Project [dst#258 AS id#263]
[2025-05-07T02:32:09.699+0000] {spark_submit.py:571} INFO - :  :  :                 +- Deduplicate [dst#258]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :  :                    +- Project [dst#258]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :  :                       +- Project [client_id#358 AS src#257, concat(atm:, region#366, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#363]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :  :                          +- Filter transaction_type#363 IN (withdrawal,deposit)
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :  :                             +- Project [transaction_id#357, client_id#358, datetime#359, amount#360, currency#361, coalesce(merchant#362, cast(no_merchant as string)) AS merchant#114, transaction_type#363, category#364, country_code#365, region#366, coalesce(device_type#367, cast(unknown as string)) AS device_type#115, session_id#368, channel#369, transaction_purpose#370, ip_network#371, recipient_id_hash#372, dt_30#79]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :  :                                +- Project [transaction_id#357, client_id#358, datetime#359, amount#360, currency#361, merchant#362, transaction_type#363, category#364, country_code#365, region#366, device_type#367, session_id#368, channel#369, transaction_purpose#370, ip_network#371, recipient_id_hash#372, cast(date_trunc(minute, datetime#359, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :  :                                   +- Relation [transaction_id#357,client_id#358,datetime#359,amount#360,currency#361,merchant#362,transaction_type#363,category#364,country_code#365,region#366,device_type#367,session_id#368,channel#369,transaction_purpose#370,ip_network#371,recipient_id_hash#372] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :  +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS b#490]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :     +- Union false, false
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [client_id#516 AS id#133]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :        +- Relation [client_id#516,first_name#517,last_name#518,email#519,passport_id#520,registration_date#521,status#522] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#143]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#143]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#142, dst#143]
[2025-05-07T02:32:09.700+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#524 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#523, client_id#524, datetime#525, amount#526, currency#527, coalesce(merchant#528, cast(no_merchant as string)) AS merchant#114, transaction_type#529, category#530, country_code#531, region#532, coalesce(device_type#533, cast(unknown as string)) AS device_type#115, session_id#534, channel#535, transaction_purpose#536, ip_network#537, recipient_id_hash#538, dt_30#79]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#523, client_id#524, datetime#525, amount#526, currency#527, merchant#528, transaction_type#529, category#530, country_code#531, region#532, device_type#533, session_id#534, channel#535, transaction_purpose#536, ip_network#537, recipient_id_hash#538, cast(date_trunc(minute, datetime#525, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#523,client_id#524,datetime#525,amount#526,currency#527,merchant#528,transaction_type#529,category#530,country_code#531,region#532,device_type#533,session_id#534,channel#535,transaction_purpose#536,ip_network#537,recipient_id_hash#538] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#166]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#166]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#165, dst#166]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(session_id#550)
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#540 AS src#165, concat(sess:, session_id#550) AS dst#166, session_id#550]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#539, client_id#540, datetime#541, amount#542, currency#543, coalesce(merchant#544, cast(no_merchant as string)) AS merchant#114, transaction_type#545, category#546, country_code#547, region#548, coalesce(device_type#549, cast(unknown as string)) AS device_type#115, session_id#550, channel#551, transaction_purpose#552, ip_network#553, recipient_id_hash#554, dt_30#79]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#539, client_id#540, datetime#541, amount#542, currency#543, merchant#544, transaction_type#545, category#546, country_code#547, region#548, device_type#549, session_id#550, channel#551, transaction_purpose#552, ip_network#553, recipient_id_hash#554, cast(date_trunc(minute, datetime#541, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#539,client_id#540,datetime#541,amount#542,currency#543,merchant#544,transaction_type#545,category#546,country_code#547,region#548,device_type#549,session_id#550,channel#551,transaction_purpose#552,ip_network#553,recipient_id_hash#554] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:09.701+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#189]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#189]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#188, dst#189]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(ip_network#569)
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#556 AS src#188, concat(ip:, ip_network#569) AS dst#189, ip_network#569]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#555, client_id#556, datetime#557, amount#558, currency#559, coalesce(merchant#560, cast(no_merchant as string)) AS merchant#114, transaction_type#561, category#562, country_code#563, region#564, coalesce(device_type#565, cast(unknown as string)) AS device_type#115, session_id#566, channel#567, transaction_purpose#568, ip_network#569, recipient_id_hash#570, dt_30#79]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#555, client_id#556, datetime#557, amount#558, currency#559, merchant#560, transaction_type#561, category#562, country_code#563, region#564, device_type#565, session_id#566, channel#567, transaction_purpose#568, ip_network#569, recipient_id_hash#570, cast(date_trunc(minute, datetime#557, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#555,client_id#556,datetime#557,amount#558,currency#559,merchant#560,transaction_type#561,category#562,country_code#563,region#564,device_type#565,session_id#566,channel#567,transaction_purpose#568,ip_network#569,recipient_id_hash#570] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#212]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#212]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#211, dst#212]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#572 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.702+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#571, client_id#572, datetime#573, amount#574, currency#575, coalesce(merchant#576, cast(no_merchant as string)) AS merchant#114, transaction_type#577, category#578, country_code#579, region#580, coalesce(device_type#581, cast(unknown as string)) AS device_type#115, session_id#582, channel#583, transaction_purpose#584, ip_network#585, recipient_id_hash#586, dt_30#79]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#571, client_id#572, datetime#573, amount#574, currency#575, merchant#576, transaction_type#577, category#578, country_code#579, region#580, device_type#581, session_id#582, channel#583, transaction_purpose#584, ip_network#585, recipient_id_hash#586, cast(date_trunc(minute, datetime#573, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#571,client_id#572,datetime#573,amount#574,currency#575,merchant#576,transaction_type#577,category#578,country_code#579,region#580,device_type#581,session_id#582,channel#583,transaction_purpose#584,ip_network#585,recipient_id_hash#586] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#235]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#235]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#234, dst#235]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(region#596)
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#588 AS src#234, concat(reg:, region#596) AS dst#235, region#596]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#587, client_id#588, datetime#589, amount#590, currency#591, coalesce(merchant#592, cast(no_merchant as string)) AS merchant#114, transaction_type#593, category#594, country_code#595, region#596, coalesce(device_type#597, cast(unknown as string)) AS device_type#115, session_id#598, channel#599, transaction_purpose#600, ip_network#601, recipient_id_hash#602, dt_30#79]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#587, client_id#588, datetime#589, amount#590, currency#591, merchant#592, transaction_type#593, category#594, country_code#595, region#596, device_type#597, session_id#598, channel#599, transaction_purpose#600, ip_network#601, recipient_id_hash#602, cast(date_trunc(minute, datetime#589, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#587,client_id#588,datetime#589,amount#590,currency#591,merchant#592,transaction_type#593,category#594,country_code#595,region#596,device_type#597,session_id#598,channel#599,transaction_purpose#600,ip_network#601,recipient_id_hash#602] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :        +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :           +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:09.703+0000] {spark_submit.py:571} INFO - :  :              +- Project [dst#258 AS id#263]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :  :                 +- Deduplicate [dst#258]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :  :                    +- Project [dst#258]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :  :                       +- Project [client_id#604 AS src#257, concat(atm:, region#612, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#609]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :  :                          +- Filter transaction_type#609 IN (withdrawal,deposit)
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :  :                             +- Project [transaction_id#603, client_id#604, datetime#605, amount#606, currency#607, coalesce(merchant#608, cast(no_merchant as string)) AS merchant#114, transaction_type#609, category#610, country_code#611, region#612, coalesce(device_type#613, cast(unknown as string)) AS device_type#115, session_id#614, channel#615, transaction_purpose#616, ip_network#617, recipient_id_hash#618, dt_30#79]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :  :                                +- Project [transaction_id#603, client_id#604, datetime#605, amount#606, currency#607, merchant#608, transaction_type#609, category#610, country_code#611, region#612, device_type#613, session_id#614, channel#615, transaction_purpose#616, ip_network#617, recipient_id_hash#618, cast(date_trunc(minute, datetime#605, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :  :                                   +- Relation [transaction_id#603,client_id#604,datetime#605,amount#606,currency#607,merchant#608,transaction_type#609,category#610,country_code#611,region#612,device_type#613,session_id#614,channel#615,transaction_purpose#616,ip_network#617,recipient_id_hash#618] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :  +- Project [struct(src, src#142, dst, dst#143, relationship, relationship#156, weight, weight#160) AS e2#625]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :     +- Union false, false
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :        :- Project [src#142, dst#143, relationship#156, weight#160]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#142, dst#143, relationship#156, 1.0 AS weight#160]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#142, dst#143, share_m AS relationship#156]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#142, dst#143]
[2025-05-07T02:32:09.704+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#632 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#631, client_id#632, datetime#633, amount#634, currency#635, coalesce(merchant#636, cast(no_merchant as string)) AS merchant#114, transaction_type#637, category#638, country_code#639, region#640, coalesce(device_type#641, cast(unknown as string)) AS device_type#115, session_id#642, channel#643, transaction_purpose#644, ip_network#645, recipient_id_hash#646, dt_30#79]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#631, client_id#632, datetime#633, amount#634, currency#635, merchant#636, transaction_type#637, category#638, country_code#639, region#640, device_type#641, session_id#642, channel#643, transaction_purpose#644, ip_network#645, recipient_id_hash#646, cast(date_trunc(minute, datetime#633, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#631,client_id#632,datetime#633,amount#634,currency#635,merchant#636,transaction_type#637,category#638,country_code#639,region#640,device_type#641,session_id#642,channel#643,transaction_purpose#644,ip_network#645,recipient_id_hash#646] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :- Project [src#165, dst#166, relationship#179, weight#183]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#165, dst#166, relationship#179, 0.5 AS weight#183]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#165, dst#166, share_sess AS relationship#179]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#165, dst#166]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(session_id#658)
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#648 AS src#165, concat(sess:, session_id#658) AS dst#166, session_id#658]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#647, client_id#648, datetime#649, amount#650, currency#651, coalesce(merchant#652, cast(no_merchant as string)) AS merchant#114, transaction_type#653, category#654, country_code#655, region#656, coalesce(device_type#657, cast(unknown as string)) AS device_type#115, session_id#658, channel#659, transaction_purpose#660, ip_network#661, recipient_id_hash#662, dt_30#79]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#647, client_id#648, datetime#649, amount#650, currency#651, merchant#652, transaction_type#653, category#654, country_code#655, region#656, device_type#657, session_id#658, channel#659, transaction_purpose#660, ip_network#661, recipient_id_hash#662, cast(date_trunc(minute, datetime#649, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#647,client_id#648,datetime#649,amount#650,currency#651,merchant#652,transaction_type#653,category#654,country_code#655,region#656,device_type#657,session_id#658,channel#659,transaction_purpose#660,ip_network#661,recipient_id_hash#662] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :- Project [src#188, dst#189, relationship#202, weight#206]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#188, dst#189, relationship#202, 0.7 AS weight#206]
[2025-05-07T02:32:09.705+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#188, dst#189, share_ip AS relationship#202]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#188, dst#189]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(ip_network#677)
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#664 AS src#188, concat(ip:, ip_network#677) AS dst#189, ip_network#677]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#663, client_id#664, datetime#665, amount#666, currency#667, coalesce(merchant#668, cast(no_merchant as string)) AS merchant#114, transaction_type#669, category#670, country_code#671, region#672, coalesce(device_type#673, cast(unknown as string)) AS device_type#115, session_id#674, channel#675, transaction_purpose#676, ip_network#677, recipient_id_hash#678, dt_30#79]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#663, client_id#664, datetime#665, amount#666, currency#667, merchant#668, transaction_type#669, category#670, country_code#671, region#672, device_type#673, session_id#674, channel#675, transaction_purpose#676, ip_network#677, recipient_id_hash#678, cast(date_trunc(minute, datetime#665, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#663,client_id#664,datetime#665,amount#666,currency#667,merchant#668,transaction_type#669,category#670,country_code#671,region#672,device_type#673,session_id#674,channel#675,transaction_purpose#676,ip_network#677,recipient_id_hash#678] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :- Project [src#211, dst#212, relationship#225, weight#229]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#211, dst#212, relationship#225, 0.3 AS weight#229]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#211, dst#212, share_dev AS relationship#225]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#211, dst#212]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#680 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#679, client_id#680, datetime#681, amount#682, currency#683, coalesce(merchant#684, cast(no_merchant as string)) AS merchant#114, transaction_type#685, category#686, country_code#687, region#688, coalesce(device_type#689, cast(unknown as string)) AS device_type#115, session_id#690, channel#691, transaction_purpose#692, ip_network#693, recipient_id_hash#694, dt_30#79]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#679, client_id#680, datetime#681, amount#682, currency#683, merchant#684, transaction_type#685, category#686, country_code#687, region#688, device_type#689, session_id#690, channel#691, transaction_purpose#692, ip_network#693, recipient_id_hash#694, cast(date_trunc(minute, datetime#681, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#679,client_id#680,datetime#681,amount#682,currency#683,merchant#684,transaction_type#685,category#686,country_code#687,region#688,device_type#689,session_id#690,channel#691,transaction_purpose#692,ip_network#693,recipient_id_hash#694] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :- Project [src#234, dst#235, relationship#248, weight#252]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#234, dst#235, relationship#248, 0.2 AS weight#252]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#234, dst#235, share_reg AS relationship#248]
[2025-05-07T02:32:09.706+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#234, dst#235]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(region#704)
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#696 AS src#234, concat(reg:, region#704) AS dst#235, region#704]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#695, client_id#696, datetime#697, amount#698, currency#699, coalesce(merchant#700, cast(no_merchant as string)) AS merchant#114, transaction_type#701, category#702, country_code#703, region#704, coalesce(device_type#705, cast(unknown as string)) AS device_type#115, session_id#706, channel#707, transaction_purpose#708, ip_network#709, recipient_id_hash#710, dt_30#79]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#695, client_id#696, datetime#697, amount#698, currency#699, merchant#700, transaction_type#701, category#702, country_code#703, region#704, device_type#705, session_id#706, channel#707, transaction_purpose#708, ip_network#709, recipient_id_hash#710, cast(date_trunc(minute, datetime#697, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#695,client_id#696,datetime#697,amount#698,currency#699,merchant#700,transaction_type#701,category#702,country_code#703,region#704,device_type#705,session_id#706,channel#707,transaction_purpose#708,ip_network#709,recipient_id_hash#710] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :        +- Project [src#257, dst#258, cast(relationship#272 as string) AS relationship#472, weight#273]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :           +- Project [src#257, dst#258, (cast(transaction_type#717 as double) + cast(_atm as double)) AS relationship#272, CASE WHEN (transaction_type#717 = withdrawal) THEN 0.8 ELSE 0.6 END AS weight#273]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :              +- Project [client_id#712 AS src#257, concat(atm:, region#720, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#717]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :                 +- Filter transaction_type#717 IN (withdrawal,deposit)
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :                    +- Project [transaction_id#711, client_id#712, datetime#713, amount#714, currency#715, coalesce(merchant#716, cast(no_merchant as string)) AS merchant#114, transaction_type#717, category#718, country_code#719, region#720, coalesce(device_type#721, cast(unknown as string)) AS device_type#115, session_id#722, channel#723, transaction_purpose#724, ip_network#725, recipient_id_hash#726, dt_30#79]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#711, client_id#712, datetime#713, amount#714, currency#715, merchant#716, transaction_type#717, category#718, country_code#719, region#720, device_type#721, session_id#722, channel#723, transaction_purpose#724, ip_network#725, recipient_id_hash#726, cast(date_trunc(minute, datetime#713, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :                          +- Relation [transaction_id#711,client_id#712,datetime#713,amount#714,currency#715,merchant#716,transaction_type#717,category#718,country_code#719,region#720,device_type#721,session_id#722,channel#723,transaction_purpose#724,ip_network#725,recipient_id_hash#726] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS c#627]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - +- Union false, false
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :     +- Project [client_id#737 AS id#133]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :        +- Relation [client_id#737,first_name#738,last_name#739,email#740,passport_id#741,registration_date#742,status#743] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:09.707+0000] {spark_submit.py:571} INFO - :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#143]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :           +- Project [dst#143]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :              +- Project [src#142, dst#143]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#745 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#744, client_id#745, datetime#746, amount#747, currency#748, coalesce(merchant#749, cast(no_merchant as string)) AS merchant#114, transaction_type#750, category#751, country_code#752, region#753, coalesce(device_type#754, cast(unknown as string)) AS device_type#115, session_id#755, channel#756, transaction_purpose#757, ip_network#758, recipient_id_hash#759, dt_30#79]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#744, client_id#745, datetime#746, amount#747, currency#748, merchant#749, transaction_type#750, category#751, country_code#752, region#753, device_type#754, session_id#755, channel#756, transaction_purpose#757, ip_network#758, recipient_id_hash#759, cast(date_trunc(minute, datetime#746, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#744,client_id#745,datetime#746,amount#747,currency#748,merchant#749,transaction_type#750,category#751,country_code#752,region#753,device_type#754,session_id#755,channel#756,transaction_purpose#757,ip_network#758,recipient_id_hash#759] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#166]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :           +- Project [dst#166]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :              +- Project [src#165, dst#166]
[2025-05-07T02:32:09.708+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(session_id#771)
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#761 AS src#165, concat(sess:, session_id#771) AS dst#166, session_id#771]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#760, client_id#761, datetime#762, amount#763, currency#764, coalesce(merchant#765, cast(no_merchant as string)) AS merchant#114, transaction_type#766, category#767, country_code#768, region#769, coalesce(device_type#770, cast(unknown as string)) AS device_type#115, session_id#771, channel#772, transaction_purpose#773, ip_network#774, recipient_id_hash#775, dt_30#79]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#760, client_id#761, datetime#762, amount#763, currency#764, merchant#765, transaction_type#766, category#767, country_code#768, region#769, device_type#770, session_id#771, channel#772, transaction_purpose#773, ip_network#774, recipient_id_hash#775, cast(date_trunc(minute, datetime#762, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#760,client_id#761,datetime#762,amount#763,currency#764,merchant#765,transaction_type#766,category#767,country_code#768,region#769,device_type#770,session_id#771,channel#772,transaction_purpose#773,ip_network#774,recipient_id_hash#775] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#189]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :           +- Project [dst#189]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :              +- Project [src#188, dst#189]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(ip_network#790)
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#777 AS src#188, concat(ip:, ip_network#790) AS dst#189, ip_network#790]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#776, client_id#777, datetime#778, amount#779, currency#780, coalesce(merchant#781, cast(no_merchant as string)) AS merchant#114, transaction_type#782, category#783, country_code#784, region#785, coalesce(device_type#786, cast(unknown as string)) AS device_type#115, session_id#787, channel#788, transaction_purpose#789, ip_network#790, recipient_id_hash#791, dt_30#79]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#776, client_id#777, datetime#778, amount#779, currency#780, merchant#781, transaction_type#782, category#783, country_code#784, region#785, device_type#786, session_id#787, channel#788, transaction_purpose#789, ip_network#790, recipient_id_hash#791, cast(date_trunc(minute, datetime#778, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.709+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#776,client_id#777,datetime#778,amount#779,currency#780,merchant#781,transaction_type#782,category#783,country_code#784,region#785,device_type#786,session_id#787,channel#788,transaction_purpose#789,ip_network#790,recipient_id_hash#791] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#212]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :           +- Project [dst#212]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :              +- Project [src#211, dst#212]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#793 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#792, client_id#793, datetime#794, amount#795, currency#796, coalesce(merchant#797, cast(no_merchant as string)) AS merchant#114, transaction_type#798, category#799, country_code#800, region#801, coalesce(device_type#802, cast(unknown as string)) AS device_type#115, session_id#803, channel#804, transaction_purpose#805, ip_network#806, recipient_id_hash#807, dt_30#79]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#792, client_id#793, datetime#794, amount#795, currency#796, merchant#797, transaction_type#798, category#799, country_code#800, region#801, device_type#802, session_id#803, channel#804, transaction_purpose#805, ip_network#806, recipient_id_hash#807, cast(date_trunc(minute, datetime#794, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.710+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#792,client_id#793,datetime#794,amount#795,currency#796,merchant#797,transaction_type#798,category#799,country_code#800,region#801,device_type#802,session_id#803,channel#804,transaction_purpose#805,ip_network#806,recipient_id_hash#807] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#235]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :           +- Project [dst#235]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :              +- Project [src#234, dst#235]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(region#817)
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#809 AS src#234, concat(reg:, region#817) AS dst#235, region#817]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#808, client_id#809, datetime#810, amount#811, currency#812, coalesce(merchant#813, cast(no_merchant as string)) AS merchant#114, transaction_type#814, category#815, country_code#816, region#817, coalesce(device_type#818, cast(unknown as string)) AS device_type#115, session_id#819, channel#820, transaction_purpose#821, ip_network#822, recipient_id_hash#823, dt_30#79]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#808, client_id#809, datetime#810, amount#811, currency#812, merchant#813, transaction_type#814, category#815, country_code#816, region#817, device_type#818, session_id#819, channel#820, transaction_purpose#821, ip_network#822, recipient_id_hash#823, cast(date_trunc(minute, datetime#810, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#808,client_id#809,datetime#810,amount#811,currency#812,merchant#813,transaction_type#814,category#815,country_code#816,region#817,device_type#818,session_id#819,channel#820,transaction_purpose#821,ip_network#822,recipient_id_hash#823] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - +- Project [dst#258 AS id#263]
[2025-05-07T02:32:09.711+0000] {spark_submit.py:571} INFO - +- Deduplicate [dst#258]
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - +- Project [dst#258]
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - +- Project [client_id#825 AS src#257, concat(atm:, region#833, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#830]
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - +- Filter transaction_type#830 IN (withdrawal,deposit)
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - +- Project [transaction_id#824, client_id#825, datetime#826, amount#827, currency#828, coalesce(merchant#829, cast(no_merchant as string)) AS merchant#114, transaction_type#830, category#831, country_code#832, region#833, coalesce(device_type#834, cast(unknown as string)) AS device_type#115, session_id#835, channel#836, transaction_purpose#837, ip_network#838, recipient_id_hash#839, dt_30#79]
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - +- Project [transaction_id#824, client_id#825, datetime#826, amount#827, currency#828, merchant#829, transaction_type#830, category#831, country_code#832, region#833, device_type#834, session_id#835, channel#836, transaction_purpose#837, ip_network#838, recipient_id_hash#839, cast(date_trunc(minute, datetime#826, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - +- Relation [transaction_id#824,client_id#825,datetime#826,amount#827,currency#828,merchant#829,transaction_type#830,category#831,country_code#832,region#833,device_type#834,session_id#835,channel#836,transaction_purpose#837,ip_network#838,recipient_id_hash#839] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - Traceback (most recent call last):
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - File "/opt/airflow/spark/build_graph.py", line 143, in main
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - proj_edges = bipartite_graph.find("(a)-[e]->(b); (b)-[e2]->(c)") \
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - File "/opt/spark/python/lib/pyspark.zip/pyspark/sql/dataframe.py", line 1685, in select
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - jdf = self._jdf.select(self._jcols(*cols))
[2025-05-07T02:32:09.712+0000] {spark_submit.py:571} INFO - File "/opt/spark/python/lib/py4j-0.10.9.5-src.zip/py4j/java_gateway.py", line 1321, in __call__
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - return_value = get_return_value(
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - File "/opt/spark/python/lib/pyspark.zip/pyspark/sql/utils.py", line 117, in deco
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - raise converted from None
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - pyspark.sql.utils.AnalysisException: grouping expressions sequence is empty, and 'a' is not an aggregate function. Wrap '(LOG1P(sum((e.`weight` * e2.`weight`))) AS weight)' in windowing function(s) or wrap 'a' in first() (or first_value) if you don't care which value you get.;
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - Aggregate [a#488.id AS src#860, c#627.id AS dst#861, shared AS relationship#862, LOG1P(sum((e#486.weight * e2#625.weight))) AS weight#864]
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - +- Filter (((a#488.bipartite = 0) AND (c#627.bipartite = 0)) AND ((b#490.bipartite = 1) AND (a#488.id < c#627.id)))
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - +- Project [a#488, e#486, b#490, e2#625, c#627]
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - +- Join Inner, (e2#625.dst = c#627.id)
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - :- Join Inner, (e2#625.src = b#490.id)
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - :  :- Join Inner, (e#486.dst = b#490.id)
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - :  :  :- Join Inner, (e#486.src = a#488.id)
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - :  :  :  :- Project [struct(src, src#142, dst, dst#143, relationship, relationship#156, weight, weight#160) AS e#486]
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - :  :  :  :  +- Union false, false
[2025-05-07T02:32:09.713+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#142, dst#143, relationship#156, weight#160]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#142, dst#143, relationship#156, 1.0 AS weight#160]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#142, dst#143, share_m AS relationship#156]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#142, dst#143]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#15 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#14, client_id#15, datetime#16, amount#17, currency#18, coalesce(merchant#19, cast(no_merchant as string)) AS merchant#114, transaction_type#20, category#21, country_code#22, region#23, coalesce(device_type#24, cast(unknown as string)) AS device_type#115, session_id#25, channel#26, transaction_purpose#27, ip_network#28, recipient_id_hash#29, dt_30#79]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#14, client_id#15, datetime#16, amount#17, currency#18, merchant#19, transaction_type#20, category#21, country_code#22, region#23, device_type#24, session_id#25, channel#26, transaction_purpose#27, ip_network#28, recipient_id_hash#29, cast(date_trunc(minute, datetime#16, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#14,client_id#15,datetime#16,amount#17,currency#18,merchant#19,transaction_type#20,category#21,country_code#22,region#23,device_type#24,session_id#25,channel#26,transaction_purpose#27,ip_network#28,recipient_id_hash#29] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#165, dst#166, relationship#179, weight#183]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#165, dst#166, relationship#179, 0.5 AS weight#183]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#165, dst#166, share_sess AS relationship#179]
[2025-05-07T02:32:09.714+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#165, dst#166]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(session_id#387)
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#377 AS src#165, concat(sess:, session_id#387) AS dst#166, session_id#387]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#376, client_id#377, datetime#378, amount#379, currency#380, coalesce(merchant#381, cast(no_merchant as string)) AS merchant#114, transaction_type#382, category#383, country_code#384, region#385, coalesce(device_type#386, cast(unknown as string)) AS device_type#115, session_id#387, channel#388, transaction_purpose#389, ip_network#390, recipient_id_hash#391, dt_30#79]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#376, client_id#377, datetime#378, amount#379, currency#380, merchant#381, transaction_type#382, category#383, country_code#384, region#385, device_type#386, session_id#387, channel#388, transaction_purpose#389, ip_network#390, recipient_id_hash#391, cast(date_trunc(minute, datetime#378, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#376,client_id#377,datetime#378,amount#379,currency#380,merchant#381,transaction_type#382,category#383,country_code#384,region#385,device_type#386,session_id#387,channel#388,transaction_purpose#389,ip_network#390,recipient_id_hash#391] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#188, dst#189, relationship#202, weight#206]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#188, dst#189, relationship#202, 0.7 AS weight#206]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#188, dst#189, share_ip AS relationship#202]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#188, dst#189]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(ip_network#410)
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#397 AS src#188, concat(ip:, ip_network#410) AS dst#189, ip_network#410]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#396, client_id#397, datetime#398, amount#399, currency#400, coalesce(merchant#401, cast(no_merchant as string)) AS merchant#114, transaction_type#402, category#403, country_code#404, region#405, coalesce(device_type#406, cast(unknown as string)) AS device_type#115, session_id#407, channel#408, transaction_purpose#409, ip_network#410, recipient_id_hash#411, dt_30#79]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#396, client_id#397, datetime#398, amount#399, currency#400, merchant#401, transaction_type#402, category#403, country_code#404, region#405, device_type#406, session_id#407, channel#408, transaction_purpose#409, ip_network#410, recipient_id_hash#411, cast(date_trunc(minute, datetime#398, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#396,client_id#397,datetime#398,amount#399,currency#400,merchant#401,transaction_type#402,category#403,country_code#404,region#405,device_type#406,session_id#407,channel#408,transaction_purpose#409,ip_network#410,recipient_id_hash#411] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#211, dst#212, relationship#225, weight#229]
[2025-05-07T02:32:09.715+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#211, dst#212, relationship#225, 0.3 AS weight#229]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#211, dst#212, share_dev AS relationship#225]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#211, dst#212]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#417 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#416, client_id#417, datetime#418, amount#419, currency#420, coalesce(merchant#421, cast(no_merchant as string)) AS merchant#114, transaction_type#422, category#423, country_code#424, region#425, coalesce(device_type#426, cast(unknown as string)) AS device_type#115, session_id#427, channel#428, transaction_purpose#429, ip_network#430, recipient_id_hash#431, dt_30#79]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#416, client_id#417, datetime#418, amount#419, currency#420, merchant#421, transaction_type#422, category#423, country_code#424, region#425, device_type#426, session_id#427, channel#428, transaction_purpose#429, ip_network#430, recipient_id_hash#431, cast(date_trunc(minute, datetime#418, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#416,client_id#417,datetime#418,amount#419,currency#420,merchant#421,transaction_type#422,category#423,country_code#424,region#425,device_type#426,session_id#427,channel#428,transaction_purpose#429,ip_network#430,recipient_id_hash#431] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#234, dst#235, relationship#248, weight#252]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#234, dst#235, relationship#248, 0.2 AS weight#252]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#234, dst#235, share_reg AS relationship#248]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#234, dst#235]
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(region#445)
[2025-05-07T02:32:09.716+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#437 AS src#234, concat(reg:, region#445) AS dst#235, region#445]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#436, client_id#437, datetime#438, amount#439, currency#440, coalesce(merchant#441, cast(no_merchant as string)) AS merchant#114, transaction_type#442, category#443, country_code#444, region#445, coalesce(device_type#446, cast(unknown as string)) AS device_type#115, session_id#447, channel#448, transaction_purpose#449, ip_network#450, recipient_id_hash#451, dt_30#79]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#436, client_id#437, datetime#438, amount#439, currency#440, merchant#441, transaction_type#442, category#443, country_code#444, region#445, device_type#446, session_id#447, channel#448, transaction_purpose#449, ip_network#450, recipient_id_hash#451, cast(date_trunc(minute, datetime#438, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#436,client_id#437,datetime#438,amount#439,currency#440,merchant#441,transaction_type#442,category#443,country_code#444,region#445,device_type#446,session_id#447,channel#448,transaction_purpose#449,ip_network#450,recipient_id_hash#451] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :     +- Project [src#257, dst#258, cast(relationship#272 as string) AS relationship#472, weight#273]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :        +- Project [src#257, dst#258, (cast(transaction_type#462 as double) + cast(_atm as double)) AS relationship#272, CASE WHEN (transaction_type#462 = withdrawal) THEN 0.8 ELSE 0.6 END AS weight#273]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :           +- Project [client_id#457 AS src#257, concat(atm:, region#465, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#462]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :              +- Filter transaction_type#462 IN (withdrawal,deposit)
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :                 +- Project [transaction_id#456, client_id#457, datetime#458, amount#459, currency#460, coalesce(merchant#461, cast(no_merchant as string)) AS merchant#114, transaction_type#462, category#463, country_code#464, region#465, coalesce(device_type#466, cast(unknown as string)) AS device_type#115, session_id#467, channel#468, transaction_purpose#469, ip_network#470, recipient_id_hash#471, dt_30#79]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :                    +- Project [transaction_id#456, client_id#457, datetime#458, amount#459, currency#460, merchant#461, transaction_type#462, category#463, country_code#464, region#465, device_type#466, session_id#467, channel#468, transaction_purpose#469, ip_network#470, recipient_id_hash#471, cast(date_trunc(minute, datetime#458, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.717+0000] {spark_submit.py:571} INFO - :  :  :  :                       +- Relation [transaction_id#456,client_id#457,datetime#458,amount#459,currency#460,merchant#461,transaction_type#462,category#463,country_code#464,region#465,device_type#466,session_id#467,channel#468,transaction_purpose#469,ip_network#470,recipient_id_hash#471] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :  +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS a#488]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :     +- Union false, false
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [client_id#0 AS id#133]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Relation [client_id#0,first_name#1,last_name#2,email#3,passport_id#4,registration_date#5,status#6] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:09.718+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#143]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#143]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#142, dst#143]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#495 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#494, client_id#495, datetime#496, amount#497, currency#498, coalesce(merchant#499, cast(no_merchant as string)) AS merchant#114, transaction_type#500, category#501, country_code#502, region#503, coalesce(device_type#504, cast(unknown as string)) AS device_type#115, session_id#505, channel#506, transaction_purpose#507, ip_network#508, recipient_id_hash#509, dt_30#79]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#494, client_id#495, datetime#496, amount#497, currency#498, merchant#499, transaction_type#500, category#501, country_code#502, region#503, device_type#504, session_id#505, channel#506, transaction_purpose#507, ip_network#508, recipient_id_hash#509, cast(date_trunc(minute, datetime#496, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#494,client_id#495,datetime#496,amount#497,currency#498,merchant#499,transaction_type#500,category#501,country_code#502,region#503,device_type#504,session_id#505,channel#506,transaction_purpose#507,ip_network#508,recipient_id_hash#509] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#166]
[2025-05-07T02:32:09.719+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#166]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#165, dst#166]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(session_id#292)
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#282 AS src#165, concat(sess:, session_id#292) AS dst#166, session_id#292]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#281, client_id#282, datetime#283, amount#284, currency#285, coalesce(merchant#286, cast(no_merchant as string)) AS merchant#114, transaction_type#287, category#288, country_code#289, region#290, coalesce(device_type#291, cast(unknown as string)) AS device_type#115, session_id#292, channel#293, transaction_purpose#294, ip_network#295, recipient_id_hash#296, dt_30#79]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#281, client_id#282, datetime#283, amount#284, currency#285, merchant#286, transaction_type#287, category#288, country_code#289, region#290, device_type#291, session_id#292, channel#293, transaction_purpose#294, ip_network#295, recipient_id_hash#296, cast(date_trunc(minute, datetime#283, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#281,client_id#282,datetime#283,amount#284,currency#285,merchant#286,transaction_type#287,category#288,country_code#289,region#290,device_type#291,session_id#292,channel#293,transaction_purpose#294,ip_network#295,recipient_id_hash#296] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#189]
[2025-05-07T02:32:09.720+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#189]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#188, dst#189]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(ip_network#314)
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#301 AS src#188, concat(ip:, ip_network#314) AS dst#189, ip_network#314]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#300, client_id#301, datetime#302, amount#303, currency#304, coalesce(merchant#305, cast(no_merchant as string)) AS merchant#114, transaction_type#306, category#307, country_code#308, region#309, coalesce(device_type#310, cast(unknown as string)) AS device_type#115, session_id#311, channel#312, transaction_purpose#313, ip_network#314, recipient_id_hash#315, dt_30#79]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#300, client_id#301, datetime#302, amount#303, currency#304, merchant#305, transaction_type#306, category#307, country_code#308, region#309, device_type#310, session_id#311, channel#312, transaction_purpose#313, ip_network#314, recipient_id_hash#315, cast(date_trunc(minute, datetime#302, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#300,client_id#301,datetime#302,amount#303,currency#304,merchant#305,transaction_type#306,category#307,country_code#308,region#309,device_type#310,session_id#311,channel#312,transaction_purpose#313,ip_network#314,recipient_id_hash#315] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#212]
[2025-05-07T02:32:09.721+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#212]
[2025-05-07T02:32:09.722+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#211, dst#212]
[2025-05-07T02:32:09.722+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.722+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#320 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.722+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#319, client_id#320, datetime#321, amount#322, currency#323, coalesce(merchant#324, cast(no_merchant as string)) AS merchant#114, transaction_type#325, category#326, country_code#327, region#328, coalesce(device_type#329, cast(unknown as string)) AS device_type#115, session_id#330, channel#331, transaction_purpose#332, ip_network#333, recipient_id_hash#334, dt_30#79]
[2025-05-07T02:32:09.722+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#319, client_id#320, datetime#321, amount#322, currency#323, merchant#324, transaction_type#325, category#326, country_code#327, region#328, device_type#329, session_id#330, channel#331, transaction_purpose#332, ip_network#333, recipient_id_hash#334, cast(date_trunc(minute, datetime#321, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.722+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#319,client_id#320,datetime#321,amount#322,currency#323,merchant#324,transaction_type#325,category#326,country_code#327,region#328,device_type#329,session_id#330,channel#331,transaction_purpose#332,ip_network#333,recipient_id_hash#334] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.723+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:09.723+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:09.723+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:09.723+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#235]
[2025-05-07T02:32:09.723+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#235]
[2025-05-07T02:32:09.723+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#234, dst#235]
[2025-05-07T02:32:09.723+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(region#347)
[2025-05-07T02:32:09.723+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#339 AS src#234, concat(reg:, region#347) AS dst#235, region#347]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#338, client_id#339, datetime#340, amount#341, currency#342, coalesce(merchant#343, cast(no_merchant as string)) AS merchant#114, transaction_type#344, category#345, country_code#346, region#347, coalesce(device_type#348, cast(unknown as string)) AS device_type#115, session_id#349, channel#350, transaction_purpose#351, ip_network#352, recipient_id_hash#353, dt_30#79]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#338, client_id#339, datetime#340, amount#341, currency#342, merchant#343, transaction_type#344, category#345, country_code#346, region#347, device_type#348, session_id#349, channel#350, transaction_purpose#351, ip_network#352, recipient_id_hash#353, cast(date_trunc(minute, datetime#340, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#338,client_id#339,datetime#340,amount#341,currency#342,merchant#343,transaction_type#344,category#345,country_code#346,region#347,device_type#348,session_id#349,channel#350,transaction_purpose#351,ip_network#352,recipient_id_hash#353] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :        +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :           +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :              +- Project [dst#258 AS id#263]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :                 +- Deduplicate [dst#258]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :                    +- Project [dst#258]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :                       +- Project [client_id#358 AS src#257, concat(atm:, region#366, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#363]
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :                          +- Filter transaction_type#363 IN (withdrawal,deposit)
[2025-05-07T02:32:09.724+0000] {spark_submit.py:571} INFO - :  :  :                             +- Project [transaction_id#357, client_id#358, datetime#359, amount#360, currency#361, coalesce(merchant#362, cast(no_merchant as string)) AS merchant#114, transaction_type#363, category#364, country_code#365, region#366, coalesce(device_type#367, cast(unknown as string)) AS device_type#115, session_id#368, channel#369, transaction_purpose#370, ip_network#371, recipient_id_hash#372, dt_30#79]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :  :                                +- Project [transaction_id#357, client_id#358, datetime#359, amount#360, currency#361, merchant#362, transaction_type#363, category#364, country_code#365, region#366, device_type#367, session_id#368, channel#369, transaction_purpose#370, ip_network#371, recipient_id_hash#372, cast(date_trunc(minute, datetime#359, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :  :                                   +- Relation [transaction_id#357,client_id#358,datetime#359,amount#360,currency#361,merchant#362,transaction_type#363,category#364,country_code#365,region#366,device_type#367,session_id#368,channel#369,transaction_purpose#370,ip_network#371,recipient_id_hash#372] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :  +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS b#490]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :     +- Union false, false
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [client_id#516 AS id#133]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :        :        +- Relation [client_id#516,first_name#517,last_name#518,email#519,passport_id#520,registration_date#521,status#522] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:09.725+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#143]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#143]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#142, dst#143]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#524 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#523, client_id#524, datetime#525, amount#526, currency#527, coalesce(merchant#528, cast(no_merchant as string)) AS merchant#114, transaction_type#529, category#530, country_code#531, region#532, coalesce(device_type#533, cast(unknown as string)) AS device_type#115, session_id#534, channel#535, transaction_purpose#536, ip_network#537, recipient_id_hash#538, dt_30#79]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#523, client_id#524, datetime#525, amount#526, currency#527, merchant#528, transaction_type#529, category#530, country_code#531, region#532, device_type#533, session_id#534, channel#535, transaction_purpose#536, ip_network#537, recipient_id_hash#538, cast(date_trunc(minute, datetime#525, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#523,client_id#524,datetime#525,amount#526,currency#527,merchant#528,transaction_type#529,category#530,country_code#531,region#532,device_type#533,session_id#534,channel#535,transaction_purpose#536,ip_network#537,recipient_id_hash#538] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:09.726+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#166]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#166]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#165, dst#166]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(session_id#550)
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#540 AS src#165, concat(sess:, session_id#550) AS dst#166, session_id#550]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#539, client_id#540, datetime#541, amount#542, currency#543, coalesce(merchant#544, cast(no_merchant as string)) AS merchant#114, transaction_type#545, category#546, country_code#547, region#548, coalesce(device_type#549, cast(unknown as string)) AS device_type#115, session_id#550, channel#551, transaction_purpose#552, ip_network#553, recipient_id_hash#554, dt_30#79]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#539, client_id#540, datetime#541, amount#542, currency#543, merchant#544, transaction_type#545, category#546, country_code#547, region#548, device_type#549, session_id#550, channel#551, transaction_purpose#552, ip_network#553, recipient_id_hash#554, cast(date_trunc(minute, datetime#541, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#539,client_id#540,datetime#541,amount#542,currency#543,merchant#544,transaction_type#545,category#546,country_code#547,region#548,device_type#549,session_id#550,channel#551,transaction_purpose#552,ip_network#553,recipient_id_hash#554] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:09.727+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#189]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#189]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#188, dst#189]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(ip_network#569)
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#556 AS src#188, concat(ip:, ip_network#569) AS dst#189, ip_network#569]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#555, client_id#556, datetime#557, amount#558, currency#559, coalesce(merchant#560, cast(no_merchant as string)) AS merchant#114, transaction_type#561, category#562, country_code#563, region#564, coalesce(device_type#565, cast(unknown as string)) AS device_type#115, session_id#566, channel#567, transaction_purpose#568, ip_network#569, recipient_id_hash#570, dt_30#79]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#555, client_id#556, datetime#557, amount#558, currency#559, merchant#560, transaction_type#561, category#562, country_code#563, region#564, device_type#565, session_id#566, channel#567, transaction_purpose#568, ip_network#569, recipient_id_hash#570, cast(date_trunc(minute, datetime#557, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#555,client_id#556,datetime#557,amount#558,currency#559,merchant#560,transaction_type#561,category#562,country_code#563,region#564,device_type#565,session_id#566,channel#567,transaction_purpose#568,ip_network#569,recipient_id_hash#570] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#212]
[2025-05-07T02:32:09.728+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#212]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#211, dst#212]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#572 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#571, client_id#572, datetime#573, amount#574, currency#575, coalesce(merchant#576, cast(no_merchant as string)) AS merchant#114, transaction_type#577, category#578, country_code#579, region#580, coalesce(device_type#581, cast(unknown as string)) AS device_type#115, session_id#582, channel#583, transaction_purpose#584, ip_network#585, recipient_id_hash#586, dt_30#79]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#571, client_id#572, datetime#573, amount#574, currency#575, merchant#576, transaction_type#577, category#578, country_code#579, region#580, device_type#581, session_id#582, channel#583, transaction_purpose#584, ip_network#585, recipient_id_hash#586, cast(date_trunc(minute, datetime#573, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#571,client_id#572,datetime#573,amount#574,currency#575,merchant#576,transaction_type#577,category#578,country_code#579,region#580,device_type#581,session_id#582,channel#583,transaction_purpose#584,ip_network#585,recipient_id_hash#586] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#235]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#235]
[2025-05-07T02:32:09.729+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#234, dst#235]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(region#596)
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#588 AS src#234, concat(reg:, region#596) AS dst#235, region#596]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#587, client_id#588, datetime#589, amount#590, currency#591, coalesce(merchant#592, cast(no_merchant as string)) AS merchant#114, transaction_type#593, category#594, country_code#595, region#596, coalesce(device_type#597, cast(unknown as string)) AS device_type#115, session_id#598, channel#599, transaction_purpose#600, ip_network#601, recipient_id_hash#602, dt_30#79]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#587, client_id#588, datetime#589, amount#590, currency#591, merchant#592, transaction_type#593, category#594, country_code#595, region#596, device_type#597, session_id#598, channel#599, transaction_purpose#600, ip_network#601, recipient_id_hash#602, cast(date_trunc(minute, datetime#589, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#587,client_id#588,datetime#589,amount#590,currency#591,merchant#592,transaction_type#593,category#594,country_code#595,region#596,device_type#597,session_id#598,channel#599,transaction_purpose#600,ip_network#601,recipient_id_hash#602] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :        +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :           +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :              +- Project [dst#258 AS id#263]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :                 +- Deduplicate [dst#258]
[2025-05-07T02:32:09.730+0000] {spark_submit.py:571} INFO - :  :                    +- Project [dst#258]
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :  :                       +- Project [client_id#604 AS src#257, concat(atm:, region#612, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#609]
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :  :                          +- Filter transaction_type#609 IN (withdrawal,deposit)
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :  :                             +- Project [transaction_id#603, client_id#604, datetime#605, amount#606, currency#607, coalesce(merchant#608, cast(no_merchant as string)) AS merchant#114, transaction_type#609, category#610, country_code#611, region#612, coalesce(device_type#613, cast(unknown as string)) AS device_type#115, session_id#614, channel#615, transaction_purpose#616, ip_network#617, recipient_id_hash#618, dt_30#79]
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :  :                                +- Project [transaction_id#603, client_id#604, datetime#605, amount#606, currency#607, merchant#608, transaction_type#609, category#610, country_code#611, region#612, device_type#613, session_id#614, channel#615, transaction_purpose#616, ip_network#617, recipient_id_hash#618, cast(date_trunc(minute, datetime#605, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :  :                                   +- Relation [transaction_id#603,client_id#604,datetime#605,amount#606,currency#607,merchant#608,transaction_type#609,category#610,country_code#611,region#612,device_type#613,session_id#614,channel#615,transaction_purpose#616,ip_network#617,recipient_id_hash#618] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :  +- Project [struct(src, src#142, dst, dst#143, relationship, relationship#156, weight, weight#160) AS e2#625]
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :     +- Union false, false
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :        :- Project [src#142, dst#143, relationship#156, weight#160]
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#142, dst#143, relationship#156, 1.0 AS weight#160]
[2025-05-07T02:32:09.731+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#142, dst#143, share_m AS relationship#156]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#142, dst#143]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#632 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#631, client_id#632, datetime#633, amount#634, currency#635, coalesce(merchant#636, cast(no_merchant as string)) AS merchant#114, transaction_type#637, category#638, country_code#639, region#640, coalesce(device_type#641, cast(unknown as string)) AS device_type#115, session_id#642, channel#643, transaction_purpose#644, ip_network#645, recipient_id_hash#646, dt_30#79]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#631, client_id#632, d25/05/07 02:32:09 INFO SparkUI: Stopped Spark web UI at http://5c5d1775d94e:4040
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - atetime#633, amount#634, currency#635, merchant#636, transaction_type#637, category#638, country_code#639, region#640, device_type#641, session_id#642, channel#643, transaction_purpose#644, ip_network#645, recipient_id_hash#646, cast(date_trunc(minute, datetime#633, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#631,client_id#632,datetime#633,amount#634,currency#635,merchant#636,transaction_type#637,category#638,country_code#639,region#640,device_type#641,session_id#642,channel#643,transaction_purpose#644,ip_network#645,recipient_id_hash#646] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :- Project [src#165, dst#166, relationship#179, weight#183]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#165, dst#166, relationship#179, 0.5 AS weight#183]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#165, dst#166, share_sess AS relationship#179]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#165, dst#166]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(session_id#658)
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#648 AS src#165, concat(sess:, session_id#658) AS dst#166, session_id#658]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#647, client_id#648, datetime#649, amount#650, currency#651, coalesce(merchant#652, cast(no_merchant as string)) AS merchant#114, transaction_type#653, category#654, country_code#655, region#656, coalesce(device_type#657, cast(unknown as string)) AS device_type#115, session_id#658, channel#659, transaction_purpose#660, ip_network#661, recipient_id_hash#662, dt_30#79]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#647, client_id#648, datetime#649, amount#650, currency#651, merchant#652, transaction_type#653, category#654, country_code#655, region#656, device_type#657, session_id#658, channel#659, transaction_purpose#660, ip_network#661, recipient_id_hash#662, cast(date_trunc(minute, datetime#649, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.732+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#647,client_id#648,datetime#649,amount#650,currency#651,merchant#652,transaction_type#653,category#654,country_code#655,region#656,device_type#657,session_id#658,channel#659,transaction_purpose#660,ip_network#661,recipient_id_hash#662] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :- Project [src#188, dst#189, relationship#202, weight#206]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#188, dst#189, relationship#202, 0.7 AS weight#206]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#188, dst#189, share_ip AS relationship#202]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#188, dst#189]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(ip_network#677)
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#664 AS src#188, concat(ip:, ip_network#677) AS dst#189, ip_network#677]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#663, client_id#664, datetime#665, amount#666, currency#667, coalesce(merchant#668, cast(no_merchant as string)) AS merchant#114, transaction_type#25/05/07 02:32:09 INFO StandaloneSchedulerBackend: Shutting down all executors
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - 669, category#670, country_code#671, region#672, coalesce(device_type#673, cast(unknown as string)) AS device_type#115, session_id#674, channel#675, transaction_purpose#676, ip_network#677, recipient_id_hash#678, dt_30#79]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#663, client_id#664, datetime#665, amount#666, currency#667, merchant#668, transaction_type#669, category#670, country_code#671, region#672, device_type#673, session_id#674, channel#675, transaction_purpose#676, ip_network#677, recipient_id_hash#678, cast(date_trunc(minute, datetime#665, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#663,client_id#664,datetime#665,amount#666,currency#667,merchant#668,transaction_type#669,category#670,country_code#671,region#672,device_type#673,session_id#674,channel#675,transaction_purpose#676,ip_network#677,recipient_id_hash#678] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :- Project [src#211, dst#212, relationship#225, weight#229]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#211, dst#212, relationship#225, 0.3 AS weight#229]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#211, dst#212, share_dev AS relationship#225]
[2025-05-07T02:32:09.733+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#211, dst#212]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#680 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#679, client_id#680, datetime#681, amount#682, currency#683, coalesce(merchant#684, cast(no_merchant as string)) AS merchant#114, transaction_type#685, category#686, country_code#687, region#688, coalesce(device_type#689, cast(unknown as string)) AS device_type#115, session_id#690, channel#691, transaction_purpose#692, ip_network#693, recipient_id_hash#694, dt_30#79]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#679, client_id#680, datetime#681, amount#682, currency#683, merchant#684, transaction_type#685, category#686, country_code#687, region#688, device_type#689, session_id#690, channel#691, transaction_purpose#692, ip_network#693, recipient_id_hash#694, cast(date_trunc(minute, datetime#681, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#679,client_id#680,datetime#681,amount#682,currency#683,merchant#684,transaction_type#685,category#686,country_code#687,region#688,device_type#689,session_id#690,channel#691,transaction_purpose#692,ip_network#693,recipient_id_hash#694] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :- Project [src#234, dst#235, relationship#248, weight#252]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#234, dst#235, relationship#248, 0.2 AS weight#252]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#234, dst#235, share_reg AS relationship#248]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#234, dst#235]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(region#704)
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#696 AS src#234, concat(reg:, region#704) AS dst#235, region#704]
[2025-05-07T02:32:09.734+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#695, client_id#696, datetime#697, amount#698, currency#699, coalesce(merchant#700, cast(no_merchant as string)) AS merchant#114, transaction_type#701, category#702, country_code#703, region#704, coalesce(device_type#705, cast(unknown as string)) AS device_type#115, session_id#706, channel#707, transaction_purpose#708, ip_network#709, recipient_id_hash#710, dt_30#79]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#695, client_id#696, datetime#697, amount#698, currency#699, merchant#700, transaction_type#701, category#702, country_code#703, region#704, device_type#705, session_id#706, channel#707, transaction_purpose#708, ip_network#709, recipient_id_hash#710, cast(date_trunc(minute, datetime#697, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#695,client_id#696,datetime#697,amount#698,currency#699,merchant#700,transaction_type#701,category#702,country_code#703,region#704,device_type#705,session_id#706,channel#707,transaction_purpose#708,ip_network#709,recipient_id_hash#710] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :        +- Project [src#257, dst#258, cast(relationship#272 as string) AS relationship#472, weight#273]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :           +- Project [src#257, dst#258, (cast(transaction_type#717 as double) + cast(_atm as double)) AS relationship#272, CASE WHEN (transaction_type#717 = withdrawal) THEN 0.8 ELSE 0.6 END AS weight#273]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :              +- Project [client_id#712 AS src#257, concat(atm:, region#720, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#717]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :                 +- Filter transaction_type#717 IN (withdrawal,deposit)
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :                    +- Project [transaction_id#711, client_id#712, datetime#713, amount#714, currency#715, coalesce(merchant#716, cast(no_merchant as string)) AS merchant#114, transaction_type#717, category#718, country_code#719, region#720, coalesce(device_type#721, cast(unknown as string)) AS device_type#115, session_id#722, channel#723, transaction_purpose#724, ip_network#725, recipient_id_hash#726, dt_30#79]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#711, client_id#712, datetime#713, amount#714, currency#715, merchant#716, transaction_type#717, category#718, country_code#719, region#720, device_type#721, session_id#722, channel#723, transaction_purpose#724, ip_network#725, recipient_id_hash#726, cast(date_trunc(minute, datetime#713, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :                          +- Relation [transaction_id#711,client_id#712,datetime#713,amount#714,currency#715,merchant#716,transaction_type#717,category#718,country_code#719,region#720,device_type#721,session_id#722,channel#723,transaction_purpose#724,ip_network#725,recipient_id_hash#726] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS c#627]
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - +- Union false, false
[2025-05-07T02:32:09.735+0000] {spark_submit.py:571} INFO - :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :     +- Project [client_id#737 AS id#133]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :        +- Relation [client_id#737,first_name#738,last_name#739,email#740,passport_id#741,registration_date#742,status#743] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#143]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :           +- Project [dst#143]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :              +- Project [src#142, dst#143]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#745 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.736+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#744, client_id#745, datetime#746, amount#747, currency#748, coalesce(merchant#749, cast(no_merchant as string)) AS merchant#114, transaction_type#750, category#751, country_code#752, region#753, coalesce(device_type#754, cast(unknown as string)) AS device_type#115, session_id#755, channel#756, transaction_purpose#757, ip_network#758, recipient_id_hash#759, dt_30#79]
[2025-05-07T02:32:09.737+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#744, client_id#745, datetime#746, amount#747, currency#748, merchant#749, transaction_type#750, category#751, country_code#752, region#753, device_type#754, session_id#755, channel#756, transaction_purpose#757, ip_network#758, recipient_id_hash#759, cast(date_trunc(minute, datetime#746, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.737+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#744,client_id#745,datetime#746,amount#747,currency#748,merchant#749,transaction_type#750,category#751,country_code#752,region#753,device_type#754,session_id#755,channel#756,transaction_purpose#757,ip_network#758,recipient_id_hash#759] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.737+0000] {spark_submit.py:571} INFO - :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:09.737+0000] {spark_submit.py:571} INFO - :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:09.737+0000] {spark_submit.py:571} INFO - :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:09.737+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#166]
[2025-05-07T02:32:09.737+0000] {spark_submit.py:571} INFO - :           +- Project [dst#166]
[2025-05-07T02:32:09.737+0000] {spark_submit.py:571} INFO - :              +- Project [src#165, dst#166]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(session_id#771)
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#761 AS src#165, concat(sess:, session_id#771) AS dst#166, session_id#771]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#760, client_id#761, datetime#762, amount#763, currency#764, coalesce(merchant#765, cast(no_merchant as string)) AS merchant#114, transaction_type#766, category#767, country_code#768, region#769, coalesce(device_type#770, cast(unknown as string)) AS device_type#115, session_id#771, channel#772, transaction_purpo25/05/07 02:32:09 INFO CoarseGrainedSchedulerBackend$DriverEndpoint: Asking each executor to shut down
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - se#773, ip_network#774, recipient_id_hash#775, dt_30#79]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#760, client_id#761, datetime#762, amount#763, currency#764, merchant#765, transaction_type#766, category#767, country_code#768, region#769, device_type#770, session_id#771, channel#772, transaction_purpose#773, ip_network#774, recipient_id_hash#775, cast(date_trunc(minute, datetime#762, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#760,client_id#761,datetime#762,amount#763,currency#764,merchant#765,transaction_type#766,category#767,country_code#768,region#769,device_type#770,session_id#771,channel#772,transaction_purpose#773,ip_network#774,recipient_id_hash#775] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#189]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :           +- Project [dst#189]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :              +- Project [src#188, dst#189]
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(ip_network#790)
[2025-05-07T02:32:09.738+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#777 AS src#188, concat(ip:, ip_network#790) AS dst#189, ip_network#790]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#776, client_id#777, datetime#778, amount#779, currency#780, coalesce(merchant#781, cast(no_merchant as string)) AS merchant#114, transaction_type#782, category#783, country_code#784, region#785, coalesce(device_type#786, cast(unknown as string)) AS device_type#115, session_id#787, channel#788, transaction_purpose#789, ip_network#790, recipient_id_hash#791, dt_30#79]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#776, client_id#777, datetime#778, amount#779, currency#780, merchant#781, transaction_type#782, category#783, country_code#784, region#785, device_type#786, session_id#787, channel#788, transaction_purpose#789, ip_network#790, recipient_id_hash#791, cast(date_trunc(minute, datetime#778, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#776,client_id#777,datetime#778,amount#779,currency#780,merchant#781,transaction_type#782,category#783,country_code#784,region#785,device_type#786,session_id#787,channel#788,transaction_purpose#789,ip_network#790,recipient_id_hash#791] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#212]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :           +- Project [dst#212]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :              +- Project [src#211, dst#212]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#793 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#792, client_id#793, datetime#794, amount#795, currency#796, coalesce(merchant#797, cast(no_merchant as string)) AS merchant#114, transaction_type#798, category#799, country_code#800, region#801, coalesce(device_type#802, cast(unknown as string)) AS device_type#115, session_id#803, channel#804, transaction_purpose#805, ip_network#806, recipient_id_hash#807, dt_30#79]
[2025-05-07T02:32:09.739+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#792, client_id#793, datetime#794, amount#795, currency#796, merchant#797, transaction_type#798, category#799, country_code#800, region#801, device_type#802, session_id#803, channel#804, transaction_purpose#805, ip_network#806, recipient_id_hash#807, cast(date_trunc(minute, datetime#794, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#792,client_id#793,datetime#794,amount#795,currency#796,merchant#797,transaction_type#798,category#799,country_code#800,region#801,device_type#802,session_id#803,channel#804,transaction_purpose#805,ip_network#806,recipient_id_hash#807] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#235]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :           +- Project [dst#235]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :              +- Project [src#234, dst#235]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(region#817)
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#809 AS src#234, concat(reg:, region#817) AS dst#235, region#817]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#808, client_id#809, datetime#810, amount#811, currency#812, coalesce(merchant#813, cast(no_merchant as string)) AS merchant#114, transaction_type#814, category#815, country_code#816, region#817, coalesce(device_type#818, cast(unknown as string)) AS device_type#115, session_id#819, channel#820, transaction_purpose#821, ip_network#822, recipient_id_hash#823, dt_30#79]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#808, client_id#809, datetime#810, amount#811, currency#812, merchant#813, transaction_type#814, category#815, country_code#816, region#817, device_type#818, session_id#819, channel#820, transaction_purpose#821, ip_network#822, recipient_id_hash#823, cast(date_trunc(minute, datetime#810, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.740+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#808,client_id#809,datetime#810,amount#811,currency#812,merchant#813,transaction_type#814,category#815,country_code#816,region#817,device_type#818,session_id#819,channel#820,transaction_purpose#821,ip_network#822,recipient_id_hash#823] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.741+0000] {spark_submit.py:571} INFO - +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:09.741+0000] {spark_submit.py:571} INFO - +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:09.741+0000] {spark_submit.py:571} INFO - +- Project [dst#258 AS id#263]
[2025-05-07T02:32:09.741+0000] {spark_submit.py:571} INFO - +- Deduplicate [dst#258]
[2025-05-07T02:32:09.742+0000] {spark_submit.py:571} INFO - +- Project [dst#258]
[2025-05-07T02:32:09.742+0000] {spark_submit.py:571} INFO - +- Project [client_id#825 AS src#257, concat(atm:, region#833, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#830]
[2025-05-07T02:32:09.742+0000] {spark_submit.py:571} INFO - +- Filter transaction_type#830 IN (withdrawal,deposit)
[2025-05-07T02:32:09.742+0000] {spark_submit.py:571} INFO - +- Project [transaction_id#824, client_id#825, datetime#826, amount#827, currency#828, coalesce(merchant#829, cast(no_merchant as string)) AS merchant#114, transaction_type#830, category#831, country_code#832, region#833, coalesce(device_type#834, cast(unknown as string)) AS device_type#115, session_id#835, channel#836, transaction_purpose#837, ip_network#838, recipient_id_hash#839, dt_30#79]
[2025-05-07T02:32:09.742+0000] {spark_submit.py:571} INFO - +- Project [transaction_id#824, client_id#825, datetime#826, amount#827, currency#828, merchant#829, transaction_type#830, category#831, country_code#832, region#833, device_type#834, session_id#835, channel#836, transaction_purpose#837, ip_network#838, recipient_id_hash#839, cast(date_trunc(minute, datetime#826, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.742+0000] {spark_submit.py:571} INFO - +- Relation [transaction_id#824,client_id#825,datetime#826,amount#827,currency#828,merchant#829,transaction_type#830,category#831,country_code#832,region#833,device_type#834,session_id#835,channel#836,transaction_purpose#837,ip_network#838,recipient_id_hash#839] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.742+0000] {spark_submit.py:571} INFO - 
[2025-05-07T02:32:09.742+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:09 INFO MapOutputTrackerMasterEndpoint: MapOutputTrackerMasterEndpoint stopped!
[2025-05-07T02:32:09.746+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:09 INFO MemoryStore: MemoryStore cleared
[2025-05-07T02:32:09.747+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:09 INFO BlockManager: BlockManager stopped
[2025-05-07T02:32:09.750+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:09 INFO BlockManagerMaster: BlockManagerMaster stopped
[2025-05-07T02:32:09.752+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:09 INFO OutputCommitCoordinator$OutputCommitCoordinatorEndpoint: OutputCommitCoordinator stopped!
[2025-05-07T02:32:09.765+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:09 INFO SparkContext: Successfully stopped SparkContext
[2025-05-07T02:32:09.967+0000] {spark_submit.py:571} INFO - 2025-05-07 02:32:09,967 [INFO] SparkSession остановлена
[2025-05-07T02:32:09.967+0000] {spark_submit.py:571} INFO - Traceback (most recent call last):
[2025-05-07T02:32:09.968+0000] {spark_submit.py:571} INFO - File "/opt/airflow/spark/build_graph.py", line 221, in <module>
[2025-05-07T02:32:09.968+0000] {spark_submit.py:571} INFO - main()
[2025-05-07T02:32:09.968+0000] {spark_submit.py:571} INFO - File "/opt/airflow/spark/build_graph.py", line 143, in main
[2025-05-07T02:32:09.968+0000] {spark_submit.py:571} INFO - proj_edges = bipartite_graph.find("(a)-[e]->(b); (b)-[e2]->(c)") \
[2025-05-07T02:32:09.968+0000] {spark_submit.py:571} INFO - File "/opt/spark/python/lib/pyspark.zip/pyspark/sql/dataframe.py", line 1685, in select
[2025-05-07T02:32:09.968+0000] {spark_submit.py:571} INFO - File "/opt/spark/python/lib/py4j-0.10.9.5-src.zip/py4j/java_gateway.py", line 1321, in __call__
[2025-05-07T02:32:09.969+0000] {spark_submit.py:571} INFO - File "/opt/spark/python/lib/pyspark.zip/pyspark/sql/utils.py", line 117, in deco
[2025-05-07T02:32:09.974+0000] {spark_submit.py:571} INFO - pyspark.sql.utils.AnalysisException: grouping expressions sequence is empty, and 'a' is not an aggregate function. Wrap '(LOG1P(sum((e.`weight` * e2.`weight`))) AS weight)' in windowing function(s) or wrap 'a' in first() (or first_value) if you don't care which value you get.;
[2025-05-07T02:32:09.975+0000] {spark_submit.py:571} INFO - Aggregate [a#488.id AS src#860, c#627.id AS dst#861, shared AS relationship#862, LOG1P(sum((e#486.weight * e2#625.weight))) AS weight#864]
[2025-05-07T02:32:09.975+0000] {spark_submit.py:571} INFO - +- Filter (((a#488.bipartite = 0) AND (c#627.bipartite = 0)) AND ((b#490.bipartite = 1) AND (a#488.id < c#627.id)))
[2025-05-07T02:32:09.975+0000] {spark_submit.py:571} INFO - +- Project [a#488, e#486, b#490, e2#625, c#627]
[2025-05-07T02:32:09.975+0000] {spark_submit.py:571} INFO - +- Join Inner, (e2#625.dst = c#627.id)
[2025-05-07T02:32:09.975+0000] {spark_submit.py:571} INFO - :- Join Inner, (e2#625.src = b#490.id)
[2025-05-07T02:32:09.975+0000] {spark_submit.py:571} INFO - :  :- Join Inner, (e#486.dst = b#490.id)
[2025-05-07T02:32:09.976+0000] {spark_submit.py:571} INFO - :  :  :- Join Inner, (e#486.src = a#488.id)
[2025-05-07T02:32:09.976+0000] {spark_submit.py:571} INFO - :  :  :  :- Project [struct(src, src#142, dst, dst#143, relationship, relationship#156, weight, weight#160) AS e#486]
[2025-05-07T02:32:09.976+0000] {spark_submit.py:571} INFO - :  :  :  :  +- Union false, false
[2025-05-07T02:32:09.976+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#142, dst#143, relationship#156, weight#160]
[2025-05-07T02:32:09.976+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#142, dst#143, relationship#156, 1.0 AS weight#160]
[2025-05-07T02:32:09.976+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#142, dst#143, share_m AS relationship#156]
[2025-05-07T02:32:09.976+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#142, dst#143]
[2025-05-07T02:32:09.977+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.977+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#15 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.977+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#14, client_id#15, datetime#16, amount#17, currency#18, coalesce(merchant#19, cast(no_merchant as string)) AS merchant#114, transaction_type#20, category#21, country_code#22, region#23, coalesce(device_type#24, cast(unknown as string)) AS device_type#115, session_id#25, channel#26, transaction_purpose#27, ip_network#28, recipient_id_hash#29, dt_30#79]
[2025-05-07T02:32:09.977+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#14, client_id#15, datetime#16, amount#17, currency#18, merchant#19, transaction_type#20, category#21, country_code#22, region#23, device_type#24, session_id#25, channel#26, transaction_purpose#27, ip_network#28, recipient_id_hash#29, cast(date_trunc(minute, datetime#16, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.977+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#14,client_id#15,datetime#16,amount#17,currency#18,merchant#19,transaction_type#20,category#21,country_code#22,region#23,device_type#24,session_id#25,channel#26,transaction_purpose#27,ip_network#28,recipient_id_hash#29] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.977+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#165, dst#166, relationship#179, weight#183]
[2025-05-07T02:32:09.978+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#165, dst#166, relationship#179, 0.5 AS weight#183]
[2025-05-07T02:32:09.978+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#165, dst#166, share_sess AS relationship#179]
[2025-05-07T02:32:09.978+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#165, dst#166]
[2025-05-07T02:32:09.978+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(session_id#387)
[2025-05-07T02:32:09.978+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#377 AS src#165, concat(sess:, session_id#387) AS dst#166, session_id#387]
[2025-05-07T02:32:09.978+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#376, client_id#377, datetime#378, amount#379, currency#380, coalesce(merchant#381, cast(no_merchant as string)) AS merchant#114, transaction_type#382, category#383, country_code#384, region#385, coalesce(device_type#386, cast(unknown as string)) AS device_type#115, session_id#387, channel#388, transaction_purpose#389, ip_network#390, recipient_id_hash#391, dt_30#79]
[2025-05-07T02:32:09.979+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#376, client_id#377, datetime#378, amount#379, currency#380, merchant#381, transaction_type#382, category#383, country_code#384, region#385, device_type#386, session_id#387, channel#388, transaction_purpose#389, ip_network#390, recipient_id_hash#391, cast(date_trunc(minute, datetime#378, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.979+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#376,client_id#377,datetime#378,amount#379,currency#380,merchant#381,transaction_type#382,category#383,country_code#384,region#385,device_type#386,session_id#387,channel#388,transaction_purpose#389,ip_network#390,recipient_id_hash#391] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.979+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#188, dst#189, relationship#202, weight#206]
[2025-05-07T02:32:09.979+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#188, dst#189, relationship#202, 0.7 AS weight#206]
[2025-05-07T02:32:09.979+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#188, dst#189, share_ip AS relationship#202]
[2025-05-07T02:32:09.979+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#188, dst#189]
[2025-05-07T02:32:09.979+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(ip_network#410)
[2025-05-07T02:32:09.980+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#397 AS src#188, concat(ip:, ip_network#410) AS dst#189, ip_network#410]
[2025-05-07T02:32:09.980+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#396, client_id#397, datetime#398, amount#399, currency#400, coalesce(merchant#401, cast(no_merchant as string)) AS merchant#114, transaction_type#402, category#403, country_code#404, region#405, coalesce(device_type#406, cast(unknown as string)) AS device_type#115, session_id#407, channel#408, transaction_purpose#409, ip_network#410, recipient_id_hash#411, dt_30#79]
[2025-05-07T02:32:09.980+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#396, client_id#397, datetime#398, amount#399, currency#400, merchant#401, transaction_type#402, category#403, country_code#404, region#405, device_type#406, session_id#407, channel#408, transaction_purpose#409, ip_network#410, recipient_id_hash#411, cast(date_trunc(minute, datetime#398, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.980+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#396,client_id#397,datetime#398,amount#399,currency#400,merchant#401,transaction_type#402,category#403,country_code#404,region#405,device_type#406,session_id#407,channel#408,transaction_purpose#409,ip_network#410,recipient_id_hash#411] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.980+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#211, dst#212, relationship#225, weight#229]
[2025-05-07T02:32:09.980+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#211, dst#212, relationship#225, 0.3 AS weight#229]
[2025-05-07T02:32:09.981+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#211, dst#212, share_dev AS relationship#225]
[2025-05-07T02:32:09.981+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#211, dst#212]
[2025-05-07T02:32:09.981+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.981+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#417 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.981+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#416, client_id#417, datetime#418, amount#419, currency#420, coalesce(merchant#421, cast(no_merchant as string)) AS merchant#114, transaction_type#422, category#423, country_code#424, region#425, coalesce(device_type#426, cast(unknown as string)) AS device_type#115, session_id#427, channel#428, transaction_purpose#429, ip_network#430, recipient_id_hash#431, dt_30#79]
[2025-05-07T02:32:09.981+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#416, client_id#417, datetime#418, amount#419, currency#420, merchant#421, transaction_type#422, category#423, country_code#424, region#425, device_type#426, session_id#427, channel#428, transaction_purpose#429, ip_network#430, recipient_id_hash#431, cast(date_trunc(minute, datetime#418, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.981+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#416,client_id#417,datetime#418,amount#419,currency#420,merchant#421,transaction_type#422,category#423,country_code#424,region#425,device_type#426,session_id#427,channel#428,transaction_purpose#429,ip_network#430,recipient_id_hash#431] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.982+0000] {spark_submit.py:571} INFO - :  :  :  :     :- Project [src#234, dst#235, relationship#248, weight#252]
[2025-05-07T02:32:09.982+0000] {spark_submit.py:571} INFO - :  :  :  :     :  +- Project [src#234, dst#235, relationship#248, 0.2 AS weight#252]
[2025-05-07T02:32:09.982+0000] {spark_submit.py:571} INFO - :  :  :  :     :     +- Project [src#234, dst#235, share_reg AS relationship#248]
[2025-05-07T02:32:09.982+0000] {spark_submit.py:571} INFO - :  :  :  :     :        +- Project [src#234, dst#235]
[2025-05-07T02:32:09.982+0000] {spark_submit.py:571} INFO - :  :  :  :     :           +- Filter isnotnull(region#445)
[2025-05-07T02:32:09.982+0000] {spark_submit.py:571} INFO - :  :  :  :     :              +- Project [client_id#437 AS src#234, concat(reg:, region#445) AS dst#235, region#445]
[2025-05-07T02:32:09.982+0000] {spark_submit.py:571} INFO - :  :  :  :     :                 +- Project [transaction_id#436, client_id#437, datetime#438, amount#439, currency#440, coalesce(merchant#441, cast(no_merchant as string)) AS merchant#114, transaction_type#442, category#443, country_code#444, region#445, coalesce(device_type#446, cast(unknown as string)) AS device_type#115, session_id#447, channel#448, transaction_purpose#449, ip_network#450, recipient_id_hash#451, dt_30#79]
[2025-05-07T02:32:09.983+0000] {spark_submit.py:571} INFO - :  :  :  :     :                    +- Project [transaction_id#436, client_id#437, datetime#438, amount#439, currency#440, merchant#441, transaction_type#442, category#443, country_code#444, region#445, device_type#446, session_id#447, channel#448, transaction_purpose#449, ip_network#450, recipient_id_hash#451, cast(date_trunc(minute, datetime#438, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.983+0000] {spark_submit.py:571} INFO - :  :  :  :     :                       +- Relation [transaction_id#436,client_id#437,datetime#438,amount#439,currency#440,merchant#441,transaction_type#442,category#443,country_code#444,region#445,device_type#446,session_id#447,channel#448,transaction_purpose#449,ip_network#450,recipient_id_hash#451] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.983+0000] {spark_submit.py:571} INFO - :  :  :  :     +- Project [src#257, dst#258, cast(relationship#272 as string) AS relationship#472, weight#273]
[2025-05-07T02:32:09.983+0000] {spark_submit.py:571} INFO - :  :  :  :        +- Project [src#257, dst#258, (cast(transaction_type#462 as double) + cast(_atm as double)) AS relationship#272, CASE WHEN (transaction_type#462 = withdrawal) THEN 0.8 ELSE 0.6 END AS weight#273]
[2025-05-07T02:32:09.983+0000] {spark_submit.py:571} INFO - :  :  :  :           +- Project [client_id#457 AS src#257, concat(atm:, region#465, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#462]
[2025-05-07T02:32:09.983+0000] {spark_submit.py:571} INFO - :  :  :  :              +- Filter transaction_type#462 IN (withdrawal,deposit)
[2025-05-07T02:32:09.983+0000] {spark_submit.py:571} INFO - :  :  :  :                 +- Project [transaction_id#456, client_id#457, datetime#458, amount#459, currency#460, coalesce(merchant#461, cast(no_merchant as string)) AS merchant#114, transaction_type#462, category#463, country_code#464, region#465, coalesce(device_type#466, cast(unknown as string)) AS device_type#115, session_id#467, channel#468, transaction_purpose#469, ip_network#470, recipient_id_hash#471, dt_30#79]
[2025-05-07T02:32:09.984+0000] {spark_submit.py:571} INFO - :  :  :  :                    +- Project [transaction_id#456, client_id#457, datetime#458, amount#459, currency#460, merchant#461, transaction_type#462, category#463, country_code#464, region#465, device_type#466, session_id#467, channel#468, transaction_purpose#469, ip_network#470, recipient_id_hash#471, cast(date_trunc(minute, datetime#458, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.984+0000] {spark_submit.py:571} INFO - :  :  :  :                       +- Relation [transaction_id#456,client_id#457,datetime#458,amount#459,currency#460,merchant#461,transaction_type#462,category#463,country_code#464,region#465,device_type#466,session_id#467,channel#468,transaction_purpose#469,ip_network#470,recipient_id_hash#471] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.984+0000] {spark_submit.py:571} INFO - :  :  :  +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS a#488]
[2025-05-07T02:32:09.984+0000] {spark_submit.py:571} INFO - :  :  :     +- Union false, false
[2025-05-07T02:32:09.984+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:09.984+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:09.984+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [client_id#0 AS id#133]
[2025-05-07T02:32:09.985+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Relation [client_id#0,first_name#1,last_name#2,email#3,passport_id#4,registration_date#5,status#6] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:09.985+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:09.985+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:09.985+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:09.985+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#143]
[2025-05-07T02:32:09.985+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#143]
[2025-05-07T02:32:09.985+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#142, dst#143]
[2025-05-07T02:32:09.986+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.986+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#495 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.986+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#494, client_id#495, datetime#496, amount#497, currency#498, coalesce(merchant#499, cast(no_merchant as string)) AS merchant#114, transaction_type#500, category#501, country_code#502, region#503, coalesce(device_type#504, cast(unknown as string)) AS device_type#115, session_id#505, channel#506, transaction_purpose#507, ip_network#508, recipient_id_hash#509, dt_30#79]
[2025-05-07T02:32:09.986+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#494, client_id#495, datetime#496, amount#497, currency#498, merchant#499, transaction_type#500, category#501, country_code#502, region#503, device_type#504, session_id#505, channel#506, transaction_purpose#507, ip_network#508, recipient_id_hash#509, cast(date_trunc(minute, datetime#496, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.986+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#494,client_id#495,datetime#496,amount#497,currency#498,merchant#499,transaction_type#500,category#501,country_code#502,region#503,device_type#504,session_id#505,channel#506,transaction_purpose#507,ip_network#508,recipient_id_hash#509] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.987+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:09.987+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:09.987+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:09.987+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#166]
[2025-05-07T02:32:09.987+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#166]
[2025-05-07T02:32:09.987+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#165, dst#166]
[2025-05-07T02:32:09.988+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(session_id#292)
[2025-05-07T02:32:09.988+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#282 AS src#165, concat(sess:, session_id#292) AS dst#166, session_id#292]
[2025-05-07T02:32:09.988+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#281, client_id#282, datetime#283, amount#284, currency#285, coalesce(merchant#286, cast(no_merchant as string)) AS merchant#114, transaction_type#287, category#288, country_code#289, region#290, coalesce(device_type#291, cast(unknown as string)) AS device_type#115, session_id#292, channel#293, transaction_purpose#294, ip_network#295, recipient_id_hash#296, dt_30#79]
[2025-05-07T02:32:09.988+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#281, client_id#282, datetime#283, amount#284, currency#285, merchant#286, transaction_type#287, category#288, country_code#289, region#290, device_type#291, session_id#292, channel#293, transaction_purpose#294, ip_network#295, recipient_id_hash#296, cast(date_trunc(minute, datetime#283, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.988+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#281,client_id#282,datetime#283,amount#284,currency#285,merchant#286,transaction_type#287,category#288,country_code#289,region#290,device_type#291,session_id#292,channel#293,transaction_purpose#294,ip_network#295,recipient_id_hash#296] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.988+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:09.989+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:09.989+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:09.989+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#189]
[2025-05-07T02:32:09.989+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#189]
[2025-05-07T02:32:09.989+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#188, dst#189]
[2025-05-07T02:32:09.990+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(ip_network#314)
[2025-05-07T02:32:09.990+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#301 AS src#188, concat(ip:, ip_network#314) AS dst#189, ip_network#314]
[2025-05-07T02:32:09.990+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#300, client_id#301, datetime#302, amount#303, currency#304, coalesce(merchant#305, cast(no_merchant as string)) AS merchant#114, transaction_type#306, category#307, country_code#308, region#309, coalesce(device_type#310, cast(unknown as string)) AS device_type#115, session_id#311, channel#312, transaction_purpose#313, ip_network#314, recipient_id_hash#315, dt_30#79]
[2025-05-07T02:32:09.990+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#300, client_id#301, datetime#302, amount#303, currency#304, merchant#305, transaction_type#306, category#307, country_code#308, region#309, device_type#310, session_id#311, channel#312, transaction_purpose#313, ip_network#314, recipient_id_hash#315, cast(date_trunc(minute, datetime#302, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.990+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#300,client_id#301,datetime#302,amount#303,currency#304,merchant#305,transaction_type#306,category#307,country_code#308,region#309,device_type#310,session_id#311,channel#312,transaction_purpose#313,ip_network#314,recipient_id_hash#315] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.990+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:09.990+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:09.991+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:09.991+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#212]
[2025-05-07T02:32:09.991+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#212]
[2025-05-07T02:32:09.991+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#211, dst#212]
[2025-05-07T02:32:09.991+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.991+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#320 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.991+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#319, client_id#320, datetime#321, amount#322, currency#323, coalesce(merchant#324, cast(no_merchant as string)) AS merchant#114, transaction_type#325, category#326, country_code#327, region#328, coalesce(device_type#329, cast(unknown as string)) AS device_type#115, session_id#330, channel#331, transaction_purpose#332, ip_network#333, recipient_id_hash#334, dt_30#79]
[2025-05-07T02:32:09.992+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#319, client_id#320, datetime#321, amount#322, currency#323, merchant#324, transaction_type#325, category#326, country_code#327, region#328, device_type#329, session_id#330, channel#331, transaction_purpose#332, ip_network#333, recipient_id_hash#334, cast(date_trunc(minute, datetime#321, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.992+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#319,client_id#320,datetime#321,amount#322,currency#323,merchant#324,transaction_type#325,category#326,country_code#327,region#328,device_type#329,session_id#330,channel#331,transaction_purpose#332,ip_network#333,recipient_id_hash#334] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.992+0000] {spark_submit.py:571} INFO - :  :  :        :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:09.992+0000] {spark_submit.py:571} INFO - :  :  :        :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:09.992+0000] {spark_submit.py:571} INFO - :  :  :        :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:09.992+0000] {spark_submit.py:571} INFO - :  :  :        :        +- Deduplicate [dst#235]
[2025-05-07T02:32:09.992+0000] {spark_submit.py:571} INFO - :  :  :        :           +- Project [dst#235]
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :        :              +- Project [src#234, dst#235]
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :        :                 +- Filter isnotnull(region#347)
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :        :                    +- Project [client_id#339 AS src#234, concat(reg:, region#347) AS dst#235, region#347]
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :        :                       +- Project [transaction_id#338, client_id#339, datetime#340, amount#341, currency#342, coalesce(merchant#343, cast(no_merchant as string)) AS merchant#114, transaction_type#344, category#345, country_code#346, region#347, coalesce(device_type#348, cast(unknown as string)) AS device_type#115, session_id#349, channel#350, transaction_purpose#351, ip_network#352, recipient_id_hash#353, dt_30#79]
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :        :                          +- Project [transaction_id#338, client_id#339, datetime#340, amount#341, currency#342, merchant#343, transaction_type#344, category#345, country_code#346, region#347, device_type#348, session_id#349, channel#350, transaction_purpose#351, ip_network#352, recipient_id_hash#353, cast(date_trunc(minute, datetime#340, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :        :                             +- Relation [transaction_id#338,client_id#339,datetime#340,amount#341,currency#342,merchant#343,transaction_type#344,category#345,country_code#346,region#347,device_type#348,session_id#349,channel#350,transaction_purpose#351,ip_network#352,recipient_id_hash#353] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :        +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :           +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:09.993+0000] {spark_submit.py:571} INFO - :  :  :              +- Project [dst#258 AS id#263]
[2025-05-07T02:32:09.994+0000] {spark_submit.py:571} INFO - :  :  :                 +- Deduplicate [dst#258]
[2025-05-07T02:32:09.994+0000] {spark_submit.py:571} INFO - :  :  :                    +- Project [dst#258]
[2025-05-07T02:32:09.994+0000] {spark_submit.py:571} INFO - :  :  :                       +- Project [client_id#358 AS src#257, concat(atm:, region#366, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#363]
[2025-05-07T02:32:09.994+0000] {spark_submit.py:571} INFO - :  :  :                          +- Filter transaction_type#363 IN (withdrawal,deposit)
[2025-05-07T02:32:09.994+0000] {spark_submit.py:571} INFO - :  :  :                             +- Project [transaction_id#357, client_id#358, datetime#359, amount#360, currency#361, coalesce(merchant#362, cast(no_merchant as string)) AS merchant#114, transaction_type#363, category#364, country_code#365, region#366, coalesce(device_type#367, cast(unknown as string)) AS device_type#115, session_id#368, channel#369, transaction_purpose#370, ip_network#371, recipient_id_hash#372, dt_30#79]
[2025-05-07T02:32:09.994+0000] {spark_submit.py:571} INFO - :  :  :                                +- Project [transaction_id#357, client_id#358, datetime#359, amount#360, currency#361, merchant#362, transaction_type#363, category#364, country_code#365, region#366, device_type#367, session_id#368, channel#369, transaction_purpose#370, ip_network#371, recipient_id_hash#372, cast(date_trunc(minute, datetime#359, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.994+0000] {spark_submit.py:571} INFO - :  :  :                                   +- Relation [transaction_id#357,client_id#358,datetime#359,amount#360,currency#361,merchant#362,transaction_type#363,category#364,country_code#365,region#366,device_type#367,session_id#368,channel#369,transaction_purpose#370,ip_network#371,recipient_id_hash#372] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.994+0000] {spark_submit.py:571} INFO - :  :  +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS b#490]
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :     +- Union false, false
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [client_id#516 AS id#133]
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :        :        +- Relation [client_id#516,first_name#517,last_name#518,email#519,passport_id#520,registration_date#521,status#522] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:09.995+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#143]
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#143]
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#142, dst#143]
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#524 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#523, client_id#524, datetime#525, amount#526, currency#527, coalesce(merchant#528, cast(no_merchant as string)) AS merchant#114, transaction_type#529, category#530, country_code#531, region#532, coalesce(device_type#533, cast(unknown as string)) AS device_type#115, session_id#534, channel#535, transaction_purpose#536, ip_network#537, recipient_id_hash#538, dt_30#79]
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#523, client_id#524, datetime#525, amount#526, currency#527, merchant#528, transaction_type#529, category#530, country_code#531, region#532, device_type#533, session_id#534, channel#535, transaction_purpose#536, ip_network#537, recipient_id_hash#538, cast(date_trunc(minute, datetime#525, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#523,client_id#524,datetime#525,amount#526,currency#527,merchant#528,transaction_type#529,category#530,country_code#531,region#532,device_type#533,session_id#534,channel#535,transaction_purpose#536,ip_network#537,recipient_id_hash#538] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:09.996+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#166]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#166]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#165, dst#166]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(session_id#550)
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#540 AS src#165, concat(sess:, session_id#550) AS dst#166, session_id#550]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#539, client_id#540, datetime#541, amount#542, currency#543, coalesce(merchant#544, cast(no_merchant as string)) AS merchant#114, transaction_type#545, category#546, country_code#547, region#548, coalesce(device_type#549, cast(unknown as string)) AS device_type#115, session_id#550, channel#551, transaction_purpose#552, ip_network#553, recipient_id_hash#554, dt_30#79]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#539, client_id#540, datetime#541, amount#542, currency#543, merchant#544, transaction_type#545, category#546, country_code#547, region#548, device_type#549, session_id#550, channel#551, transaction_purpose#552, ip_network#553, recipient_id_hash#554, cast(date_trunc(minute, datetime#541, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#539,client_id#540,datetime#541,amount#542,currency#543,merchant#544,transaction_type#545,category#546,country_code#547,region#548,device_type#549,session_id#550,channel#551,transaction_purpose#552,ip_network#553,recipient_id_hash#554] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.997+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#189]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#189]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#188, dst#189]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(ip_network#569)
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#556 AS src#188, concat(ip:, ip_network#569) AS dst#189, ip_network#569]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#555, client_id#556, datetime#557, amount#558, currency#559, coalesce(merchant#560, cast(no_merchant as string)) AS merchant#114, transaction_type#561, category#562, country_code#563, region#564, coalesce(device_type#565, cast(unknown as string)) AS device_type#115, session_id#566, channel#567, transaction_purpose#568, ip_network#569, recipient_id_hash#570, dt_30#79]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#555, client_id#556, datetime#557, amount#558, currency#559, merchant#560, transaction_type#561, category#562, country_code#563, region#564, device_type#565, session_id#566, channel#567, transaction_purpose#568, ip_network#569, recipient_id_hash#570, cast(date_trunc(minute, datetime#557, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:09.998+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#555,client_id#556,datetime#557,amount#558,currency#559,merchant#560,transaction_type#561,category#562,country_code#563,region#564,device_type#565,session_id#566,channel#567,transaction_purpose#568,ip_network#569,recipient_id_hash#570] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#212]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#212]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#211, dst#212]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#572 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#571, client_id#572, datetime#573, amount#574, currency#575, coalesce(merchant#576, cast(no_merchant as string)) AS merchant#114, transaction_type#577, category#578, country_code#579, region#580, coalesce(device_type#581, cast(unknown as string)) AS device_type#115, session_id#582, channel#583, transaction_purpose#584, ip_network#585, recipient_id_hash#586, dt_30#79]
[2025-05-07T02:32:09.999+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#571, client_id#572, datetime#573, amount#574, currency#575, merchant#576, transaction_type#577, category#578, country_code#579, region#580, device_type#581, session_id#582, channel#583, transaction_purpose#584, ip_network#585, recipient_id_hash#586, cast(date_trunc(minute, datetime#573, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#571,client_id#572,datetime#573,amount#574,currency#575,merchant#576,transaction_type#577,category#578,country_code#579,region#580,device_type#581,session_id#582,channel#583,transaction_purpose#584,ip_network#585,recipient_id_hash#586] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :        +- Deduplicate [dst#235]
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :           +- Project [dst#235]
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :              +- Project [src#234, dst#235]
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :                 +- Filter isnotnull(region#596)
[2025-05-07T02:32:10.000+0000] {spark_submit.py:571} INFO - :  :        :                    +- Project [client_id#588 AS src#234, concat(reg:, region#596) AS dst#235, region#596]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :        :                       +- Project [transaction_id#587, client_id#588, datetime#589, amount#590, currency#591, coalesce(merchant#592, cast(no_merchant as string)) AS merchant#114, transaction_type#593, category#594, country_code#595, region#596, coalesce(device_type#597, cast(unknown as string)) AS device_type#115, session_id#598, channel#599, transaction_purpose#600, ip_network#601, recipient_id_hash#602, dt_30#79]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :        :                          +- Project [transaction_id#587, client_id#588, datetime#589, amount#590, currency#591, merchant#592, transaction_type#593, category#594, country_code#595, region#596, device_type#597, session_id#598, channel#599, transaction_purpose#600, ip_network#601, recipient_id_hash#602, cast(date_trunc(minute, datetime#589, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :        :                             +- Relation [transaction_id#587,client_id#588,datetime#589,amount#590,currency#591,merchant#592,transaction_type#593,category#594,country_code#595,region#596,device_type#597,session_id#598,channel#599,transaction_purpose#600,ip_network#601,recipient_id_hash#602] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :        +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :           +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :              +- Project [dst#258 AS id#263]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :                 +- Deduplicate [dst#258]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :                    +- Project [dst#258]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :                       +- Project [client_id#604 AS src#257, concat(atm:, region#612, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#609]
[2025-05-07T02:32:10.001+0000] {spark_submit.py:571} INFO - :  :                          +- Filter transaction_type#609 IN (withdrawal,deposit)
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :  :                             +- Project [transaction_id#603, client_id#604, datetime#605, amount#606, currency#607, coalesce(merchant#608, cast(no_merchant as string)) AS merchant#114, transaction_type#609, category#610, country_code#611, region#612, coalesce(device_type#613, cast(unknown as string)) AS device_type#115, session_id#614, channel#615, transaction_purpose#616, ip_network#617, recipient_id_hash#618, dt_30#79]
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :  :                                +- Project [transaction_id#603, client_id#604, datetime#605, amount#606, currency#607, merchant#608, transaction_type#609, category#610, country_code#611, region#612, device_type#613, session_id#614, channel#615, transaction_purpose#616, ip_network#617, recipient_id_hash#618, cast(date_trunc(minute, datetime#605, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :  :                                   +- Relation [transaction_id#603,client_id#604,datetime#605,amount#606,currency#607,merchant#608,transaction_type#609,category#610,country_code#611,region#612,device_type#613,session_id#614,channel#615,transaction_purpose#616,ip_network#617,recipient_id_hash#618] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :  +- Project [struct(src, src#142, dst, dst#143, relationship, relationship#156, weight, weight#160) AS e2#625]
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :     +- Union false, false
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :        :- Project [src#142, dst#143, relationship#156, weight#160]
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#142, dst#143, relationship#156, 1.0 AS weight#160]
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#142, dst#143, share_m AS relationship#156]
[2025-05-07T02:32:10.002+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#142, dst#143]
[2025-05-07T02:32:10.003+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:10.003+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#632 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:10.003+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#631, client_id#632, datetime#633, amount#634, currency#635, coalesce(merchant#636, cast(no_merchant as string)) AS merchant#114, transaction_type#637, category#638, country_code#639, region#640, coalesce(device_type#641, cast(unknown as string)) AS device_type#115, session_id#642, channel#643, transaction_purpose#644, ip_network#645, recipient_id_hash#646, dt_30#79]
[2025-05-07T02:32:10.003+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#631, client_id#632, datetime#633, amount#634, currency#635, merchant#636, transaction_type#637, category#638, country_code#639, region#640, device_type#641, session_id#642, channel#643, transaction_purpose#644, ip_network#645, recipient_id_hash#646, cast(date_trunc(minute, datetime#633, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.003+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#631,client_id#632,datetime#633,amount#634,currency#635,merchant#636,transaction_type#637,category#638,country_code#639,region#640,device_type#641,session_id#642,channel#643,transaction_purpose#644,ip_network#645,recipient_id_hash#646] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.003+0000] {spark_submit.py:571} INFO - :        :- Project [src#165, dst#166, relationship#179, weight#183]
[2025-05-07T02:32:10.003+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#165, dst#166, relationship#179, 0.5 AS weight#183]
[2025-05-07T02:32:10.004+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#165, dst#166, share_sess AS relationship#179]
[2025-05-07T02:32:10.004+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#165, dst#166]
[2025-05-07T02:32:10.004+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(session_id#658)
[2025-05-07T02:32:10.004+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#648 AS src#165, concat(sess:, session_id#658) AS dst#166, session_id#658]
[2025-05-07T02:32:10.004+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#647, client_id#648, datetime#649, amount#650, currency#651, coalesce(merchant#652, cast(no_merchant as string)) AS merchant#114, transaction_type#653, category#654, country_code#655, region#656, coalesce(device_type#657, cast(unknown as string)) AS device_type#115, session_id#658, channel#659, transaction_purpose#660, ip_network#661, recipient_id_hash#662, dt_30#79]
[2025-05-07T02:32:10.004+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#647, client_id#648, datetime#649, amount#650, currency#651, merchant#652, transaction_type#653, category#654, country_code#655, region#656, device_type#657, session_id#658, channel#659, transaction_purpose#660, ip_network#661, recipient_id_hash#662, cast(date_trunc(minute, datetime#649, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.004+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#647,client_id#648,datetime#649,amount#650,currency#651,merchant#652,transaction_type#653,category#654,country_code#655,region#656,device_type#657,session_id#658,channel#659,transaction_purpose#660,ip_network#661,recipient_id_hash#662] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.004+0000] {spark_submit.py:571} INFO - :        :- Project [src#188, dst#189, relationship#202, weight#206]
[2025-05-07T02:32:10.005+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#188, dst#189, relationship#202, 0.7 AS weight#206]
[2025-05-07T02:32:10.005+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#188, dst#189, share_ip AS relationship#202]
[2025-05-07T02:32:10.005+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#188, dst#189]
[2025-05-07T02:32:10.005+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(ip_network#677)
[2025-05-07T02:32:10.005+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#664 AS src#188, concat(ip:, ip_network#677) AS dst#189, ip_network#677]
[2025-05-07T02:32:10.005+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#663, client_id#664, datetime#665, amount#666, currency#667, coalesce(merchant#668, cast(no_merchant as string)) AS merchant#114, transaction_type#669, category#670, country_code#671, region#672, coalesce(device_type#673, cast(unknown as string)) AS device_type#115, session_id#674, channel#675, transaction_purpose#676, ip_network#677, recipient_id_hash#678, dt_30#79]
[2025-05-07T02:32:10.005+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#663, client_id#664, datetime#665, amount#666, currency#667, merchant#668, transaction_type#669, category#670, country_code#671, region#672, device_type#673, session_id#674, channel#675, transaction_purpose#676, ip_network#677, recipient_id_hash#678, cast(date_trunc(minute, datetime#665, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#663,client_id#664,datetime#665,amount#666,currency#667,merchant#668,transaction_type#669,category#670,country_code#671,region#672,device_type#673,session_id#674,channel#675,transaction_purpose#676,ip_network#677,recipient_id_hash#678] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :- Project [src#211, dst#212, relationship#225, weight#229]
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#211, dst#212, relationship#225, 0.3 AS weight#229]
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#211, dst#212, share_dev AS relationship#225]
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#211, dst#212]
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#680 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#679, client_id#680, datetime#681, amount#682, currency#683, coalesce(merchant#684, cast(no_merchant as string)) AS merchant#114, transaction_type#685, category#686, country_code#687, region#688, coalesce(device_type#689, cast(unknown as string)) AS device_type#115, session_id#690, channel#691, transaction_purpose#692, ip_network#693, recipient_id_hash#694, dt_30#79]
[2025-05-07T02:32:10.006+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#679, client_id#680, datetime#681, amount#682, currency#683, merchant#684, transaction_type#685, category#686, country_code#687, region#688, device_type#689, session_id#690, channel#691, transaction_purpose#692, ip_network#693, recipient_id_hash#694, cast(date_trunc(minute, datetime#681, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#679,client_id#680,datetime#681,amount#682,currency#683,merchant#684,transaction_type#685,category#686,country_code#687,region#688,device_type#689,session_id#690,channel#691,transaction_purpose#692,ip_network#693,recipient_id_hash#694] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :- Project [src#234, dst#235, relationship#248, weight#252]
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :  +- Project [src#234, dst#235, relationship#248, 0.2 AS weight#252]
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :     +- Project [src#234, dst#235, share_reg AS relationship#248]
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :        +- Project [src#234, dst#235]
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :           +- Filter isnotnull(region#704)
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :              +- Project [client_id#696 AS src#234, concat(reg:, region#704) AS dst#235, region#704]
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :                 +- Project [transaction_id#695, client_id#696, datetime#697, amount#698, currency#699, coalesce(merchant#700, cast(no_merchant as string)) AS merchant#114, transaction_type#701, category#702, country_code#703, region#704, coalesce(device_type#705, cast(unknown as string)) AS device_type#115, session_id#706, channel#707, transaction_purpose#708, ip_network#709, recipient_id_hash#710, dt_30#79]
[2025-05-07T02:32:10.007+0000] {spark_submit.py:571} INFO - :        :                    +- Project [transaction_id#695, client_id#696, datetime#697, amount#698, currency#699, merchant#700, transaction_type#701, category#702, country_code#703, region#704, device_type#705, session_id#706, channel#707, transaction_purpose#708, ip_network#709, recipient_id_hash#710, cast(date_trunc(minute, datetime#697, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :        :                       +- Relation [transaction_id#695,client_id#696,datetime#697,amount#698,currency#699,merchant#700,transaction_type#701,category#702,country_code#703,region#704,device_type#705,session_id#706,channel#707,transaction_purpose#708,ip_network#709,recipient_id_hash#710] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :        +- Project [src#257, dst#258, cast(relationship#272 as string) AS relationship#472, weight#273]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :           +- Project [src#257, dst#258, (cast(transaction_type#717 as double) + cast(_atm as double)) AS relationship#272, CASE WHEN (transaction_type#717 = withdrawal) THEN 0.8 ELSE 0.6 END AS weight#273]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :              +- Project [client_id#712 AS src#257, concat(atm:, region#720, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#717]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :                 +- Filter transaction_type#717 IN (withdrawal,deposit)
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :                    +- Project [transaction_id#711, client_id#712, datetime#713, amount#714, currency#715, coalesce(merchant#716, cast(no_merchant as string)) AS merchant#114, transaction_type#717, category#718, country_code#719, region#720, coalesce(device_type#721, cast(unknown as string)) AS device_type#115, session_id#722, channel#723, transaction_purpose#724, ip_network#725, recipient_id_hash#726, dt_30#79]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#711, client_id#712, datetime#713, amount#714, currency#715, merchant#716, transaction_type#717, category#718, country_code#719, region#720, device_type#721, session_id#722, channel#723, transaction_purpose#724, ip_network#725, recipient_id_hash#726, cast(date_trunc(minute, datetime#713, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :                          +- Relation [transaction_id#711,client_id#712,datetime#713,amount#714,currency#715,merchant#716,transaction_type#717,category#718,country_code#719,region#720,device_type#721,session_id#722,channel#723,transaction_purpose#724,ip_network#725,recipient_id_hash#726] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - +- Project [struct(id, id#133, ntype, ntype#135, bipartite, bipartite#138) AS c#627]
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - +- Union false, false
[2025-05-07T02:32:10.008+0000] {spark_submit.py:571} INFO - :- Project [id#133, ntype#135, 0 AS bipartite#138]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :  +- Project [id#133, client AS ntype#135]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :     +- Project [client_id#737 AS id#133]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :        +- Relation [client_id#737,first_name#738,last_name#739,email#740,passport_id#741,registration_date#742,status#743] JDBCRelation(staging.clients) [numPartitions=1]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :- Project [id#147, ntype#149, 1 AS bipartite#152]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :  +- Project [id#147, m AS ntype#149]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :     +- Project [dst#143 AS id#147]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#143]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :           +- Project [dst#143]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :              +- Project [src#142, dst#143]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(merchant#114)
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#745 AS src#142, concat(m:, merchant#114) AS dst#143, merchant#114]
[2025-05-07T02:32:10.009+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#744, client_id#745, datetime#746, amount#747, currency#748, coalesce(merchant#749, cast(no_merchant as string)) AS merchant#114, transaction_type#750, category#751, country_code#752, region#753, coalesce(device_type#754, cast(unknown as string)) AS device_type#115, session_id#755, channel#756, transaction_purpose#757, ip_network#758, recipient_id_hash#759, dt_30#79]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#744, client_id#745, datetime#746, amount#747, currency#748, merchant#749, transaction_type#750, category#751, country_code#752, region#753, device_type#754, session_id#755, channel#756, transaction_purpose#757, ip_network#758, recipient_id_hash#759, cast(date_trunc(minute, datetime#746, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#744,client_id#745,datetime#746,amount#747,currency#748,merchant#749,transaction_type#750,category#751,country_code#752,region#753,device_type#754,session_id#755,channel#756,transaction_purpose#757,ip_network#758,recipient_id_hash#759] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :- Project [id#170, ntype#172, 1 AS bipartite#175]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :  +- Project [id#170, sess AS ntype#172]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :     +- Project [dst#166 AS id#170]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#166]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :           +- Project [dst#166]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :              +- Project [src#165, dst#166]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(session_id#771)
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#761 AS src#165, concat(sess:, session_id#771) AS dst#166, session_id#771]
[2025-05-07T02:32:10.010+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#760, client_id#761, datetime#762, amount#763, currency#764, coalesce(merchant#765, cast(no_merchant as string)) AS merchant#114, transaction_type#766, category#767, country_code#768, region#769, coalesce(device_type#770, cast(unknown as string)) AS device_type#115, session_id#771, channel#772, transaction_purpose#773, ip_network#774, recipient_id_hash#775, dt_30#79]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#760, client_id#761, datetime#762, amount#763, currency#764, merchant#765, transaction_type#766, category#767, country_code#768, region#769, device_type#770, session_id#771, channel#772, transaction_purpose#773, ip_network#774, recipient_id_hash#775, cast(date_trunc(minute, datetime#762, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#760,client_id#761,datetime#762,amount#763,currency#764,merchant#765,transaction_type#766,category#767,country_code#768,region#769,device_type#770,session_id#771,channel#772,transaction_purpose#773,ip_network#774,recipient_id_hash#775] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :- Project [id#193, ntype#195, 1 AS bipartite#198]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :  +- Project [id#193, ip AS ntype#195]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :     +- Project [dst#189 AS id#193]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#189]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :           +- Project [dst#189]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :              +- Project [src#188, dst#189]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(ip_network#790)
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#777 AS src#188, concat(ip:, ip_network#790) AS dst#189, ip_network#790]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#776, client_id#777, datetime#778, amount#779, currency#780, coalesce(merchant#781, cast(no_merchant as string)) AS merchant#114, transaction_type#782, category#783, country_code#784, region#785, coalesce(device_type#786, cast(unknown as string)) AS device_type#115, session_id#787, channel#788, transaction_purpose#789, ip_network#790, recipient_id_hash#791, dt_30#79]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#776, client_id#777, datetime#778, amount#779, currency#780, merchant#781, transaction_type#782, category#783, country_code#784, region#785, device_type#786, session_id#787, channel#788, transaction_purpose#789, ip_network#790, recipient_id_hash#791, cast(date_trunc(minute, datetime#778, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.011+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#776,client_id#777,datetime#778,amount#779,currency#780,merchant#781,transaction_type#782,category#783,country_code#784,region#785,device_type#786,session_id#787,channel#788,transaction_purpose#789,ip_network#790,recipient_id_hash#791] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :- Project [id#216, ntype#218, 1 AS bipartite#221]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :  +- Project [id#216, dev AS ntype#218]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :     +- Project [dst#212 AS id#216]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#212]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :           +- Project [dst#212]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :              +- Project [src#211, dst#212]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(device_type#115)
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#793 AS src#211, concat(dev:, device_type#115) AS dst#212, device_type#115]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#792, client_id#793, datetime#794, amount#795, currency#796, coalesce(merchant#797, cast(no_merchant as string)) AS merchant#114, transaction_type#798, category#799, country_code#800, region#801, coalesce(device_type#802, cast(unknown as string)) AS device_type#115, session_id#803, channel#804, transaction_purpose#805, ip_network#806, recipient_id_hash#807, dt_30#79]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#792, client_id#793, datetime#794, amount#795, currency#796, merchant#797, transaction_type#798, category#799, country_code#800, region#801, device_type#802, session_id#803, channel#804, transaction_purpose#805, ip_network#806, recipient_id_hash#807, cast(date_trunc(minute, datetime#794, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#792,client_id#793,datetime#794,amount#795,currency#796,merchant#797,transaction_type#798,category#799,country_code#800,region#801,device_type#802,session_id#803,channel#804,transaction_purpose#805,ip_network#806,recipient_id_hash#807] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :- Project [id#239, ntype#241, 1 AS bipartite#244]
[2025-05-07T02:32:10.012+0000] {spark_submit.py:571} INFO - :  +- Project [id#239, reg AS ntype#241]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :     +- Project [dst#235 AS id#239]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :        +- Deduplicate [dst#235]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :           +- Project [dst#235]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :              +- Project [src#234, dst#235]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :                 +- Filter isnotnull(region#817)
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :                    +- Project [client_id#809 AS src#234, concat(reg:, region#817) AS dst#235, region#817]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :                       +- Project [transaction_id#808, client_id#809, datetime#810, amount#811, currency#812, coalesce(merchant#813, cast(no_merchant as string)) AS merchant#114, transaction_type#814, category#815, country_code#816, region#817, coalesce(device_type#818, cast(unknown as string)) AS device_type#115, session_id#819, channel#820, transaction_purpose#821, ip_network#822, recipient_id_hash#823, dt_30#79]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :                          +- Project [transaction_id#808, client_id#809, datetime#810, amount#811, currency#812, merchant#813, transaction_type#814, category#815, country_code#816, region#817, device_type#818, session_id#819, channel#820, transaction_purpose#821, ip_network#822, recipient_id_hash#823, cast(date_trunc(minute, datetime#810, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - :                             +- Relation [transaction_id#808,client_id#809,datetime#810,amount#811,currency#812,merchant#813,transaction_type#814,category#815,country_code#816,region#817,device_type#818,session_id#819,channel#820,transaction_purpose#821,ip_network#822,recipient_id_hash#823] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - +- Project [id#263, ntype#265, 1 AS bipartite#268]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - +- Project [id#263, atm AS ntype#265]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - +- Project [dst#258 AS id#263]
[2025-05-07T02:32:10.013+0000] {spark_submit.py:571} INFO - +- Deduplicate [dst#258]
[2025-05-07T02:32:10.014+0000] {spark_submit.py:571} INFO - +- Project [dst#258]
[2025-05-07T02:32:10.014+0000] {spark_submit.py:571} INFO - +- Project [client_id#825 AS src#257, concat(atm:, region#833, :, cast(dt_30#79 as string)) AS dst#258, transaction_type#830]
[2025-05-07T02:32:10.014+0000] {spark_submit.py:571} INFO - +- Filter transaction_type#830 IN (withdrawal,deposit)
[2025-05-07T02:32:10.014+0000] {spark_submit.py:571} INFO - +- Project [transaction_id#824, client_id#825, datetime#826, amount#827, currency#828, coalesce(merchant#829, cast(no_merchant as string)) AS merchant#114, transaction_type#830, category#831, country_code#832, region#833, coalesce(device_type#834, cast(unknown as string)) AS device_type#115, session_id#835, channel#836, transaction_purpose#837, ip_network#838, recipient_id_hash#839, dt_30#79]
[2025-05-07T02:32:10.014+0000] {spark_submit.py:571} INFO - +- Project [transaction_id#824, client_id#825, datetime#826, amount#827, currency#828, merchant#829, transaction_type#830, category#831, country_code#832, region#833, device_type#834, session_id#835, channel#836, transaction_purpose#837, ip_network#838, recipient_id_hash#839, cast(date_trunc(minute, datetime#826, Some(Etc/UTC)) as timestamp) AS dt_30#79]
[2025-05-07T02:32:10.014+0000] {spark_submit.py:571} INFO - +- Relation [transaction_id#824,client_id#825,datetime#826,amount#827,currency#828,merchant#829,transaction_type#830,category#831,country_code#832,region#833,device_type#834,session_id#835,channel#836,transaction_purpose#837,ip_network#838,recipient_id_hash#839] JDBCRelation(raw.masked_transactions) [numPartitions=1]
[2025-05-07T02:32:10.014+0000] {spark_submit.py:571} INFO - 
[2025-05-07T02:32:10.071+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:10 INFO ShutdownHookManager: Shutdown hook called
[2025-05-07T02:32:10.072+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:10 INFO ShutdownHookManager: Deleting directory /tmp/spark-6c0bf680-691b-4024-b887-d36c340192ec
[2025-05-07T02:32:10.075+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:10 INFO ShutdownHookManager: Deleting directory /tmp/spark-eba3e539-7989-4f48-a226-4d74e2928db7
[2025-05-07T02:32:10.077+0000] {spark_submit.py:571} INFO - 25/05/07 02:32:10 INFO ShutdownHookManager: Deleting directory /tmp/spark-6c0bf680-691b-4024-b887-d36c340192ec/pyspark-1ec1696c-2827-4151-895b-fee5bead245f
[2025-05-07T02:32:10.136+0000] {taskinstance.py:1824} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/apache/spark/operators/spark_submit.py", line 174, in execute
    self._hook.submit(self.application)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/apache/spark/hooks/spark_submit.py", line 502, in submit
    raise AirflowException(
airflow.exceptions.AirflowException: Cannot execute: spark-submit --master spark://spark-master:7077 --conf spark.driver.maxResultSize=512m --conf spark.sql.shuffle.partitions=10 --packages org.postgresql:postgresql:42.6.0,graphframes:graphframes:0.8.2-spark3.2-s_2.12 --executor-cores 1 --executor-memory 1g --driver-memory 1g --name arrow-spark --verbose /opt/airflow/spark/build_graph.py --jdbc jdbc:postgresql://postgres:5432/finbest --user finbest --password ******. Error code is: 1.
[2025-05-07T02:32:10.141+0000] {taskinstance.py:1345} INFO - Marking task as UP_FOR_RETRY. dag_id=graph_analysis, task_id=build_graph, execution_date=20250507T023149, start_date=20250507T023157, end_date=20250507T023210
[2025-05-07T02:32:10.150+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 243 for task build_graph (Cannot execute: spark-submit --master spark://spark-master:7077 --conf spark.driver.maxResultSize=512m --conf spark.sql.shuffle.partitions=10 --packages org.postgresql:postgresql:42.6.0,graphframes:graphframes:0.8.2-spark3.2-s_2.12 --executor-cores 1 --executor-memory 1g --driver-memory 1g --name arrow-spark --verbose /opt/airflow/spark/build_graph.py --jdbc jdbc:postgresql://postgres:5432/finbest --user finbest --password ******. Error code is: 1.; 5081)
[2025-05-07T02:32:10.162+0000] {local_task_job_runner.py:225} INFO - Task exited with return code 1
[2025-05-07T02:32:10.183+0000] {taskinstance.py:2653} INFO - 0 downstream tasks scheduled from follow-on schedule check
